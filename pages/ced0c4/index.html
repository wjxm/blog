<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>django知识点整理 | leiyiming</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/leiyiming.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.d0955bb3.css" as="style"><link rel="preload" href="/assets/js/app.5a5da2fb.js" as="script"><link rel="preload" href="/assets/js/3.821dca7b.js" as="script"><link rel="preload" href="/assets/js/51.b2442e53.js" as="script"><link rel="prefetch" href="/assets/js/10.9852282e.js"><link rel="prefetch" href="/assets/js/100.7c45f365.js"><link rel="prefetch" href="/assets/js/101.0b6fd756.js"><link rel="prefetch" href="/assets/js/102.9b1a17ec.js"><link rel="prefetch" href="/assets/js/103.0026c5ce.js"><link rel="prefetch" href="/assets/js/104.1d4bc4ac.js"><link rel="prefetch" href="/assets/js/105.781bccb8.js"><link rel="prefetch" href="/assets/js/106.6db8a027.js"><link rel="prefetch" href="/assets/js/107.598e6623.js"><link rel="prefetch" href="/assets/js/108.2213ca95.js"><link rel="prefetch" href="/assets/js/109.8ff02308.js"><link rel="prefetch" href="/assets/js/11.12bad52b.js"><link rel="prefetch" href="/assets/js/110.09bc3e3f.js"><link rel="prefetch" href="/assets/js/111.55489f82.js"><link rel="prefetch" href="/assets/js/112.ba2de635.js"><link rel="prefetch" href="/assets/js/113.2f7611e9.js"><link rel="prefetch" href="/assets/js/114.d22df47b.js"><link rel="prefetch" href="/assets/js/115.3b850edb.js"><link rel="prefetch" href="/assets/js/116.03cd3db7.js"><link rel="prefetch" href="/assets/js/117.ed80ae0a.js"><link rel="prefetch" href="/assets/js/118.ab1522f5.js"><link rel="prefetch" href="/assets/js/119.6f8464fe.js"><link rel="prefetch" href="/assets/js/12.85819ba0.js"><link rel="prefetch" href="/assets/js/120.4a58bc61.js"><link rel="prefetch" href="/assets/js/121.40d46799.js"><link rel="prefetch" href="/assets/js/122.e3e171c5.js"><link rel="prefetch" href="/assets/js/123.b4f547be.js"><link rel="prefetch" href="/assets/js/124.0377623f.js"><link rel="prefetch" href="/assets/js/125.c362fd54.js"><link rel="prefetch" href="/assets/js/126.1dc1dde2.js"><link rel="prefetch" href="/assets/js/127.22fb3408.js"><link rel="prefetch" href="/assets/js/128.c2c8337b.js"><link rel="prefetch" href="/assets/js/129.32a12fb7.js"><link rel="prefetch" href="/assets/js/13.8c9ae546.js"><link rel="prefetch" href="/assets/js/130.cd6ff745.js"><link rel="prefetch" href="/assets/js/131.7dbfa329.js"><link rel="prefetch" href="/assets/js/132.09ce3187.js"><link rel="prefetch" href="/assets/js/133.8c92eb2c.js"><link rel="prefetch" href="/assets/js/134.6274ed26.js"><link rel="prefetch" href="/assets/js/135.5873481a.js"><link rel="prefetch" href="/assets/js/136.524954f7.js"><link rel="prefetch" href="/assets/js/137.b1291ea7.js"><link rel="prefetch" href="/assets/js/138.dbbdae86.js"><link rel="prefetch" href="/assets/js/139.a3886bd0.js"><link rel="prefetch" href="/assets/js/14.9cf0ea5d.js"><link rel="prefetch" href="/assets/js/140.0a157b65.js"><link rel="prefetch" href="/assets/js/141.b2cb5c9d.js"><link rel="prefetch" href="/assets/js/142.74f6f6b3.js"><link rel="prefetch" href="/assets/js/143.f6324462.js"><link rel="prefetch" href="/assets/js/144.db4c590f.js"><link rel="prefetch" href="/assets/js/145.fb649e56.js"><link rel="prefetch" href="/assets/js/146.ff08c31d.js"><link rel="prefetch" href="/assets/js/147.cabc1d17.js"><link rel="prefetch" href="/assets/js/148.d546863e.js"><link rel="prefetch" href="/assets/js/149.b7a9e877.js"><link rel="prefetch" href="/assets/js/15.adfe2159.js"><link rel="prefetch" href="/assets/js/150.67cb01e1.js"><link rel="prefetch" href="/assets/js/151.56bef1d1.js"><link rel="prefetch" href="/assets/js/152.8f2be78f.js"><link rel="prefetch" href="/assets/js/153.73fbc877.js"><link rel="prefetch" href="/assets/js/154.54910367.js"><link rel="prefetch" href="/assets/js/155.44e6afe3.js"><link rel="prefetch" href="/assets/js/156.b8a83578.js"><link rel="prefetch" href="/assets/js/157.b6836867.js"><link rel="prefetch" href="/assets/js/158.06dbf8d3.js"><link rel="prefetch" href="/assets/js/159.a6c299ce.js"><link rel="prefetch" href="/assets/js/16.796e9849.js"><link rel="prefetch" href="/assets/js/160.883c3c80.js"><link rel="prefetch" href="/assets/js/161.9ef5c8f0.js"><link rel="prefetch" href="/assets/js/162.a34ebe57.js"><link rel="prefetch" href="/assets/js/163.1dc610f4.js"><link rel="prefetch" href="/assets/js/164.52772501.js"><link rel="prefetch" href="/assets/js/165.d81eb131.js"><link rel="prefetch" href="/assets/js/166.1c2b05c8.js"><link rel="prefetch" href="/assets/js/167.59c7a978.js"><link rel="prefetch" href="/assets/js/168.c6f540e4.js"><link rel="prefetch" href="/assets/js/169.0e7cec4c.js"><link rel="prefetch" href="/assets/js/17.aa05cce5.js"><link rel="prefetch" href="/assets/js/170.dbca84bc.js"><link rel="prefetch" href="/assets/js/171.70d986f2.js"><link rel="prefetch" href="/assets/js/172.c621bba7.js"><link rel="prefetch" href="/assets/js/173.ecead21f.js"><link rel="prefetch" href="/assets/js/174.c700b8c9.js"><link rel="prefetch" href="/assets/js/175.8ed512ea.js"><link rel="prefetch" href="/assets/js/176.7bbafce7.js"><link rel="prefetch" href="/assets/js/177.ffed6e2d.js"><link rel="prefetch" href="/assets/js/178.335802cc.js"><link rel="prefetch" href="/assets/js/179.ccfd79fb.js"><link rel="prefetch" href="/assets/js/18.efdccabe.js"><link rel="prefetch" href="/assets/js/180.9c1ade03.js"><link rel="prefetch" href="/assets/js/181.99879d95.js"><link rel="prefetch" href="/assets/js/182.eced676b.js"><link rel="prefetch" href="/assets/js/183.893358a9.js"><link rel="prefetch" href="/assets/js/184.af0f3aa0.js"><link rel="prefetch" href="/assets/js/185.891602f2.js"><link rel="prefetch" href="/assets/js/186.cc83747c.js"><link rel="prefetch" href="/assets/js/187.9fc67979.js"><link rel="prefetch" href="/assets/js/188.242af5cd.js"><link rel="prefetch" href="/assets/js/189.21602267.js"><link rel="prefetch" href="/assets/js/19.84038016.js"><link rel="prefetch" href="/assets/js/190.08558cea.js"><link rel="prefetch" href="/assets/js/191.42d31ba7.js"><link rel="prefetch" href="/assets/js/192.f0cc9e10.js"><link rel="prefetch" href="/assets/js/193.720ca123.js"><link rel="prefetch" href="/assets/js/194.b6f5a7af.js"><link rel="prefetch" href="/assets/js/195.dfd5866c.js"><link rel="prefetch" href="/assets/js/196.0f445c60.js"><link rel="prefetch" href="/assets/js/197.23a6a872.js"><link rel="prefetch" href="/assets/js/198.5cedd5a8.js"><link rel="prefetch" href="/assets/js/199.34565e66.js"><link rel="prefetch" href="/assets/js/20.9574bd71.js"><link rel="prefetch" href="/assets/js/200.45b97230.js"><link rel="prefetch" href="/assets/js/201.29272888.js"><link rel="prefetch" href="/assets/js/202.3f31b09e.js"><link rel="prefetch" href="/assets/js/203.dd16c535.js"><link rel="prefetch" href="/assets/js/204.963abad0.js"><link rel="prefetch" href="/assets/js/205.c85840b5.js"><link rel="prefetch" href="/assets/js/206.fca6e5f9.js"><link rel="prefetch" href="/assets/js/207.069efcd9.js"><link rel="prefetch" href="/assets/js/208.6cd5a5ca.js"><link rel="prefetch" href="/assets/js/209.75a257c5.js"><link rel="prefetch" href="/assets/js/21.0573275a.js"><link rel="prefetch" href="/assets/js/210.fd40c750.js"><link rel="prefetch" href="/assets/js/211.86ff9439.js"><link rel="prefetch" href="/assets/js/212.1041b987.js"><link rel="prefetch" href="/assets/js/213.d84a5fb8.js"><link rel="prefetch" href="/assets/js/214.a329a289.js"><link rel="prefetch" href="/assets/js/215.1b5b3bc5.js"><link rel="prefetch" href="/assets/js/216.f3447a7f.js"><link rel="prefetch" href="/assets/js/217.1343956f.js"><link rel="prefetch" href="/assets/js/218.b5ed6b59.js"><link rel="prefetch" href="/assets/js/219.59af6aba.js"><link rel="prefetch" href="/assets/js/22.97300f14.js"><link rel="prefetch" href="/assets/js/220.b4dec470.js"><link rel="prefetch" href="/assets/js/221.f4bc3a82.js"><link rel="prefetch" href="/assets/js/222.ce4d7d54.js"><link rel="prefetch" href="/assets/js/223.9ab798d4.js"><link rel="prefetch" href="/assets/js/224.2cd185ad.js"><link rel="prefetch" href="/assets/js/225.5292a5e6.js"><link rel="prefetch" href="/assets/js/226.b8aabc78.js"><link rel="prefetch" href="/assets/js/227.5a1fe42b.js"><link rel="prefetch" href="/assets/js/228.d2e1beac.js"><link rel="prefetch" href="/assets/js/229.39d90d94.js"><link rel="prefetch" href="/assets/js/23.353e907c.js"><link rel="prefetch" href="/assets/js/230.910bf674.js"><link rel="prefetch" href="/assets/js/231.306b7f0d.js"><link rel="prefetch" href="/assets/js/232.5339bffb.js"><link rel="prefetch" href="/assets/js/233.b5b00b4c.js"><link rel="prefetch" href="/assets/js/234.2b7b7301.js"><link rel="prefetch" href="/assets/js/235.e0bc7b41.js"><link rel="prefetch" href="/assets/js/236.8523d2c2.js"><link rel="prefetch" href="/assets/js/237.bac872b9.js"><link rel="prefetch" href="/assets/js/238.38e00578.js"><link rel="prefetch" href="/assets/js/239.b9d84d26.js"><link rel="prefetch" href="/assets/js/24.2e1a7b1a.js"><link rel="prefetch" href="/assets/js/240.d59a5713.js"><link rel="prefetch" href="/assets/js/241.afb0364a.js"><link rel="prefetch" href="/assets/js/242.e4bfec87.js"><link rel="prefetch" href="/assets/js/243.a0727645.js"><link rel="prefetch" href="/assets/js/244.1b7a5d62.js"><link rel="prefetch" href="/assets/js/245.4e38c3dd.js"><link rel="prefetch" href="/assets/js/246.7b1b85df.js"><link rel="prefetch" href="/assets/js/247.f29d381b.js"><link rel="prefetch" href="/assets/js/248.8adbbe5f.js"><link rel="prefetch" href="/assets/js/249.e3a80190.js"><link rel="prefetch" href="/assets/js/25.47e1bc41.js"><link rel="prefetch" href="/assets/js/250.cd6d0e5d.js"><link rel="prefetch" href="/assets/js/251.e358bf32.js"><link rel="prefetch" href="/assets/js/252.e063c39b.js"><link rel="prefetch" href="/assets/js/253.f58812c7.js"><link rel="prefetch" href="/assets/js/254.e38bfdc1.js"><link rel="prefetch" href="/assets/js/255.76ea906e.js"><link rel="prefetch" href="/assets/js/256.8f02f22c.js"><link rel="prefetch" href="/assets/js/257.f72b3324.js"><link rel="prefetch" href="/assets/js/258.75fce7cf.js"><link rel="prefetch" href="/assets/js/259.8f7bd67d.js"><link rel="prefetch" href="/assets/js/26.ae157178.js"><link rel="prefetch" href="/assets/js/260.8a1f8121.js"><link rel="prefetch" href="/assets/js/261.848935d4.js"><link rel="prefetch" href="/assets/js/262.57689ab5.js"><link rel="prefetch" href="/assets/js/263.c203818f.js"><link rel="prefetch" href="/assets/js/264.5a98c30a.js"><link rel="prefetch" href="/assets/js/265.beeaa69f.js"><link rel="prefetch" href="/assets/js/266.4cb976f3.js"><link rel="prefetch" href="/assets/js/267.80712160.js"><link rel="prefetch" href="/assets/js/268.e075888c.js"><link rel="prefetch" href="/assets/js/269.cb6de7a8.js"><link rel="prefetch" href="/assets/js/27.8abcf7e3.js"><link rel="prefetch" href="/assets/js/270.7a99b96c.js"><link rel="prefetch" href="/assets/js/271.3b985f79.js"><link rel="prefetch" href="/assets/js/272.1a2135d3.js"><link rel="prefetch" href="/assets/js/273.342034c8.js"><link rel="prefetch" href="/assets/js/274.c6bb3a47.js"><link rel="prefetch" href="/assets/js/275.15b79540.js"><link rel="prefetch" href="/assets/js/276.2ccc79cc.js"><link rel="prefetch" href="/assets/js/277.65bc3883.js"><link rel="prefetch" href="/assets/js/278.58a3b18b.js"><link rel="prefetch" href="/assets/js/279.3ae608e7.js"><link rel="prefetch" href="/assets/js/28.acbb02aa.js"><link rel="prefetch" href="/assets/js/280.89c9baae.js"><link rel="prefetch" href="/assets/js/281.4520bebf.js"><link rel="prefetch" href="/assets/js/282.ba3e8129.js"><link rel="prefetch" href="/assets/js/283.4bd51778.js"><link rel="prefetch" href="/assets/js/284.ed502235.js"><link rel="prefetch" href="/assets/js/285.d8d76c09.js"><link rel="prefetch" href="/assets/js/286.2c2d033f.js"><link rel="prefetch" href="/assets/js/287.8c037ed7.js"><link rel="prefetch" href="/assets/js/288.dc36c869.js"><link rel="prefetch" href="/assets/js/289.6a3e68a3.js"><link rel="prefetch" href="/assets/js/29.5bb153b8.js"><link rel="prefetch" href="/assets/js/290.00b475c7.js"><link rel="prefetch" href="/assets/js/291.e9857f8a.js"><link rel="prefetch" href="/assets/js/292.c4556945.js"><link rel="prefetch" href="/assets/js/293.91cc1e5b.js"><link rel="prefetch" href="/assets/js/294.ef5be963.js"><link rel="prefetch" href="/assets/js/295.5c1f8837.js"><link rel="prefetch" href="/assets/js/296.647b4c12.js"><link rel="prefetch" href="/assets/js/297.56edf8c3.js"><link rel="prefetch" href="/assets/js/298.8008e1aa.js"><link rel="prefetch" href="/assets/js/299.ad158cb5.js"><link rel="prefetch" href="/assets/js/30.b059dc4f.js"><link rel="prefetch" href="/assets/js/300.0e00add7.js"><link rel="prefetch" href="/assets/js/301.3454760b.js"><link rel="prefetch" href="/assets/js/302.7b3ce785.js"><link rel="prefetch" href="/assets/js/303.e6cbcbbd.js"><link rel="prefetch" href="/assets/js/304.b5f1c954.js"><link rel="prefetch" href="/assets/js/31.817224be.js"><link rel="prefetch" href="/assets/js/32.1baa4a59.js"><link rel="prefetch" href="/assets/js/33.03231e8b.js"><link rel="prefetch" href="/assets/js/34.1fede0f7.js"><link rel="prefetch" href="/assets/js/35.3c3054e0.js"><link rel="prefetch" href="/assets/js/36.85726a6a.js"><link rel="prefetch" href="/assets/js/37.36599e71.js"><link rel="prefetch" href="/assets/js/38.bbbd7e2c.js"><link rel="prefetch" href="/assets/js/39.22241f7b.js"><link rel="prefetch" href="/assets/js/4.04b5940b.js"><link rel="prefetch" href="/assets/js/40.d7e8a360.js"><link rel="prefetch" href="/assets/js/41.c8ec1352.js"><link rel="prefetch" href="/assets/js/42.4431237e.js"><link rel="prefetch" href="/assets/js/43.d3117389.js"><link rel="prefetch" href="/assets/js/44.f5ff0ad6.js"><link rel="prefetch" href="/assets/js/45.3104271d.js"><link rel="prefetch" href="/assets/js/46.10b81e30.js"><link rel="prefetch" href="/assets/js/47.2ffb86bc.js"><link rel="prefetch" href="/assets/js/48.36e677f7.js"><link rel="prefetch" href="/assets/js/49.a61aecce.js"><link rel="prefetch" href="/assets/js/5.d6503814.js"><link rel="prefetch" href="/assets/js/50.428e42bc.js"><link rel="prefetch" href="/assets/js/52.24220879.js"><link rel="prefetch" href="/assets/js/53.1d57505d.js"><link rel="prefetch" href="/assets/js/54.7ecfdf47.js"><link rel="prefetch" href="/assets/js/55.258d529c.js"><link rel="prefetch" href="/assets/js/56.ac89334e.js"><link rel="prefetch" href="/assets/js/57.1fb77d95.js"><link rel="prefetch" href="/assets/js/58.305fd31c.js"><link rel="prefetch" href="/assets/js/59.b5a03667.js"><link rel="prefetch" href="/assets/js/6.0b841a98.js"><link rel="prefetch" href="/assets/js/60.ae42b5b0.js"><link rel="prefetch" href="/assets/js/61.08219534.js"><link rel="prefetch" href="/assets/js/62.8c40b917.js"><link rel="prefetch" href="/assets/js/63.f4739319.js"><link rel="prefetch" href="/assets/js/64.54ebcfb2.js"><link rel="prefetch" href="/assets/js/65.9752c213.js"><link rel="prefetch" href="/assets/js/66.1cd0d701.js"><link rel="prefetch" href="/assets/js/67.d3017293.js"><link rel="prefetch" href="/assets/js/68.20636e19.js"><link rel="prefetch" href="/assets/js/69.0807b7ea.js"><link rel="prefetch" href="/assets/js/7.11d0554a.js"><link rel="prefetch" href="/assets/js/70.a926b273.js"><link rel="prefetch" href="/assets/js/71.142a7552.js"><link rel="prefetch" href="/assets/js/72.4b4bb782.js"><link rel="prefetch" href="/assets/js/73.89876e41.js"><link rel="prefetch" href="/assets/js/74.d924e58d.js"><link rel="prefetch" href="/assets/js/75.c55373bd.js"><link rel="prefetch" href="/assets/js/76.a63ef2c2.js"><link rel="prefetch" href="/assets/js/77.395dba19.js"><link rel="prefetch" href="/assets/js/78.e401ef2b.js"><link rel="prefetch" href="/assets/js/79.eb4e1d85.js"><link rel="prefetch" href="/assets/js/8.846b6d51.js"><link rel="prefetch" href="/assets/js/80.65dcd190.js"><link rel="prefetch" href="/assets/js/81.f39e53b8.js"><link rel="prefetch" href="/assets/js/82.f0c9e4d3.js"><link rel="prefetch" href="/assets/js/83.1a63e0b4.js"><link rel="prefetch" href="/assets/js/84.e1a295a2.js"><link rel="prefetch" href="/assets/js/85.962db26f.js"><link rel="prefetch" href="/assets/js/86.f36db1d6.js"><link rel="prefetch" href="/assets/js/87.e28561ea.js"><link rel="prefetch" href="/assets/js/88.22984fde.js"><link rel="prefetch" href="/assets/js/89.5061c07e.js"><link rel="prefetch" href="/assets/js/9.06fe44ca.js"><link rel="prefetch" href="/assets/js/90.22ee87cd.js"><link rel="prefetch" href="/assets/js/91.dc9bd978.js"><link rel="prefetch" href="/assets/js/92.73a78d89.js"><link rel="prefetch" href="/assets/js/93.a8dff2ef.js"><link rel="prefetch" href="/assets/js/94.afc252fc.js"><link rel="prefetch" href="/assets/js/95.92ae9090.js"><link rel="prefetch" href="/assets/js/96.ffb1b5f5.js"><link rel="prefetch" href="/assets/js/97.b12cb276.js"><link rel="prefetch" href="/assets/js/98.53dccd5c.js"><link rel="prefetch" href="/assets/js/99.622046ba.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5b61a30d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d0955bb3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">leiyiming</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/pages/802a1ca6f7b71c59/" class="nav-link">Vue</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》笔记</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》笔记</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》笔记</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/wx-miniprogram/" class="nav-link">小程序笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/back-end/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/755557/" class="nav-link">django</a></li><li class="dropdown-item"><!----> <a href="/pages/2367e4b3/" class="nav-link">vue+django商城</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><a href="/language/" class="link-title">语言</a> <span class="title" style="display:none;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ad618746/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/pages/6c11ae14/" class="nav-link">c++</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><a href="/algorithm/" class="link-title">算法</a> <span class="title" style="display:none;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a9af157b/" class="nav-link">算法基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">小教程</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/eee83a9211a70f9d/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/pages/12df8ace52d493f6/" class="nav-link">Vue资源</a></li></ul></div></div><div class="nav-item"><a href="/pages/算法/" class="nav-link">电子书</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="typora://newfile" target="_blank" rel="noopener noreferrer" class="nav-link external">
  新建笔记
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/comment/" class="nav-link">记录墙</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li></ul></div></div> <a href="https://github.com/wjxm/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/leiyiming.png"> <div class="blogger-info"><h3></h3> <span>
        持续学习中
      </span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/pages/802a1ca6f7b71c59/" class="nav-link">Vue</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》笔记</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》笔记</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》笔记</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/wx-miniprogram/" class="nav-link">小程序笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/back-end/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/755557/" class="nav-link">django</a></li><li class="dropdown-item"><!----> <a href="/pages/2367e4b3/" class="nav-link">vue+django商城</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><a href="/language/" class="link-title">语言</a> <span class="title" style="display:none;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ad618746/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/pages/6c11ae14/" class="nav-link">c++</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><a href="/algorithm/" class="link-title">算法</a> <span class="title" style="display:none;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a9af157b/" class="nav-link">算法基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">小教程</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/eee83a9211a70f9d/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/pages/12df8ace52d493f6/" class="nav-link">Vue资源</a></li></ul></div></div><div class="nav-item"><a href="/pages/算法/" class="nav-link">电子书</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="typora://newfile" target="_blank" rel="noopener noreferrer" class="nav-link external">
  新建笔记
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/comment/" class="nav-link">记录墙</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li></ul></div></div> <a href="https://github.com/wjxm/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>django</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/cb26a5/" class="sidebar-link">django基础</a></li><li><a href="/pages/ced0c4/" aria-current="page" class="active sidebar-link">django知识点整理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ced0c4/#路由" class="sidebar-link">路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ced0c4/#django是如何处理请求的" class="sidebar-link">django是如何处理请求的</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#路由控制" class="sidebar-link">路由控制</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#模板" class="sidebar-link">模板</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ced0c4/#深度变量的查找" class="sidebar-link">深度变量的查找</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#模板值与过滤器" class="sidebar-link">模板值与过滤器</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#模板语法-标签" class="sidebar-link">模板语法-标签</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#自定义标签与过滤器" class="sidebar-link">自定义标签与过滤器</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#注释" class="sidebar-link">注释</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#模型" class="sidebar-link">模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ced0c4/#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#单表" class="sidebar-link">单表</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#多表" class="sidebar-link">多表</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#django-ajax" class="sidebar-link">django-ajax</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#组件" class="sidebar-link">组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ced0c4/#auth模块" class="sidebar-link">auth模块</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#form组件" class="sidebar-link">form组件</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#分页器" class="sidebar-link">分页器</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#cookie与session" class="sidebar-link">cookie与session</a></li><li class="sidebar-sub-header"><a href="/pages/ced0c4/#中间件" class="sidebar-link">中间件</a></li></ul></li></ul></li><li><a href="/pages/700736/" class="sidebar-link">rbac权限组件的开发</a></li><li><a href="/pages/f39971/" class="sidebar-link">错误总结</a></li><li><a href="/pages/ea4d7a/" class="sidebar-link">官方文档</a></li><li><a href="/pages/070d30/" class="sidebar-link">规范</a></li><li><a href="/pages/259759/" class="sidebar-link">基础</a></li><li><a href="/pages/4c918c/" class="sidebar-link">模板</a></li><li><a href="/pages/0c5a0d/" class="sidebar-link">django之视图</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue+django商城</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue+django生鲜项目</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-f6108aee><div class="articleInfo" data-v-f6108aee><ul class="breadcrumbs" data-v-f6108aee><li data-v-f6108aee><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-f6108aee></a></li> <li data-v-f6108aee><a href="/back-end" title="后端-目录页" data-v-f6108aee>后端</a></li> <li data-v-f6108aee><a href="/back-end/#django" title="后端#django" data-v-f6108aee>django</a></li></ul> <div class="info" data-v-f6108aee><div title="作者" class="author iconfont icon-touxiang" data-v-f6108aee><a href="https://github.com/wjxm" target="_blank" title="作者" class="beLink" data-v-f6108aee>leiyiming</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-f6108aee><a href="javascript:;" data-v-f6108aee>2020-06-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><!---->
          django知识点整理
        </h1> <div class="theme-vdoing-content content__default"><h2 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h2> <h3 id="django是如何处理请求的"><a href="#django是如何处理请求的" class="header-anchor">#</a> django是如何处理请求的</h3> <p><img src="https://leiyiming.oss-cn-shenzhen.aliyuncs.com/img/image-20200625221438692.png" alt="image-20200625221438692"></p> <p>当你运行python manage.py runserver，脚本将在于manage.py同一个目录下查找名为setting.py的文件。这个文件包含了所有有关这个Django项目的配置信息，</p> <p>总结一下：</p> <ul><li>进来的请求转入/hello/.</li> <li>Django通过在ROOT_URLCONF配置来决定根URLconf.</li> <li>Django在URLconf中的所有URL模式中，查找第一个匹配/hello/的条目。</li> <li>如果找到匹配，将调用相应的视图函数</li> <li>视图函数返回一个HttpResponse</li> <li>Django转换HttpResponse为一个适合的HTTP response， 以Web page显示出来</li></ul> <h3 id="路由控制"><a href="#路由控制" class="header-anchor">#</a> 路由控制</h3> <p><strong>urlconf</strong><em>URLconf</em> 就像是 Django 所支撑网站的目录。 它的本质是 URL 模式以及要为该 URL 模式调用的视图函数之间的映射表。</p> <div class="language- extra-class"><pre class="language-text"><code>from django.conf.urls import url
from . import views
urlpatterns = [
    path(r'index', views.index),
    re_path(r'^articles/([0-9]{4})/$', views.year_archive),
    re_path(r'^articles/([0-9]{4})/([0-9]{2})/$', views.month_archive),
    re_path(r'^articles/([0-9]{4})/([0-9]{2})/([0-9]+)/$', views.article_detail),
]
</code></pre></div><p><strong>urlpatterns</strong></p> <p>Django在检查URL模式前，移除每一个申请的URL开头的斜杠(/)。 这意味着我们为/hello/写URL模式不用包含斜杠(/)任何不匹配或尾部没有斜杠(/)的申请URL，将被重定向至尾部包含斜杠的相同字眼的URL。</p> <p>动态路由配置</p> <p><strong>正则表达式</strong></p> <table><thead><tr><th>符号</th> <th>匹配</th></tr></thead> <tbody><tr><td>. (dot)</td> <td>任意单一字符</td></tr> <tr><td>\d</td> <td>任意一位数字</td></tr> <tr><td>[A-Z]</td> <td>A 到 Z中任意一个字符（大写）</td></tr> <tr><td>[a-z]</td> <td>a 到 z中任意一个字符（小写）</td></tr> <tr><td>[A-Za-z]</td> <td>a 到 z中任意一个字符（不区分大小写）</td></tr> <tr><td>+</td> <td>匹配一个或更多 (例如, \d+ 匹配一个或 多个数字字符)</td></tr> <tr><td>[^/]+</td> <td>一个或多个不为‘/’的字符</td></tr> <tr><td>*</td> <td>零个或一个之前的表达式（例如：\d? 匹配零个或一个数字）</td></tr> <tr><td>*</td> <td>匹配0个或更多 (例如, \d* 匹配0个 或更多数字字符)</td></tr> <tr><td>{1,3}</td> <td>介于一个和三个（包含）之前的表达式（例如，\d{1,3}匹配一个或两个或三个数字）</td></tr></tbody></table> <p>例如</p> <div class="language- extra-class"><pre class="language-text"><code>urlpatterns = patterns('',
    
    (r'^time/plus/\d+/$', hours_ahead),       
    表示诸如time/plus/2, time/plus/30/,以数字结尾的路由都调用hour_ahead这个视图函数
)
</code></pre></div><p><strong>分组</strong></p> <div class="language- extra-class"><pre class="language-text"><code>from django.conf.urls import re_path
from . import views
urlpatterns = [
    re_path(r'^articles/([0-9]{4})/$', views.year_archive),
    re_path(r'^articles/([0-9]{4})/([0-9]{2})/$', views.month_archive),
    re_path(r'^articles/([0-9]{4})/([0-9]{2})/([0-9]+)/$', views.article_detail),
]
</code></pre></div><p><strong>django 会将分组获取到的值按顺序传入视图函数，视图函数也应根据分组的多少，动态的添加参数</strong></p> <p><code>url(r'^articles/([0-9]{4})/$', views.year_archive)</code></p> <p><strong>有名分组</strong></p> <p>语法：<code>(?P&lt;name&gt;pattern)</code>，其中name 是组的名称，pattern 是要匹配的模式。有N个分组，所对应的函数就要设置至少n+1 个参数</p> <div class="language- extra-class"><pre class="language-text"><code>urlpatterns = [
    url(r'^articles/(?P&lt;year&gt;[0-9]{4})/(?P&lt;month&gt;[0-9]{2})/$', views.month_archive),]
</code></pre></div><p><strong>注意</strong></p> <ul><li>&quot;^$&quot;表示什么路径都没有时，要匹配哪个函数</li> <li>若要从URL 中捕获一个值，只需要在它周围放置一对圆括号。捕获的值会作为一个位置参数传后面的函数，相当于后面的函数会多一个参数,捕获的值是作为字符串传入的， （从技术上来说，捕获值总是Unicode objects，而不是简单的Python字节串，但目前不需要担心这些差别。）</li> <li>不需要添加一个前导的反斜杠，因为每个URL 都有。例如，应该是^articles 而不是 ^/articles。</li> <li>每个正则表达式前面的'r' 是可选的但是建议加上。它告诉Python 这个字符串是“原始的” —— 字符串中任何字符都不应该转义</li></ul> <p><strong>路由控制之分发</strong></p> <ul><li>导入分发的函数，include</li> <li>应用app01里创建一个url.py</li> <li>Re_path(r&quot;app01/&quot;,include(&quot;app01.urls&quot;),进入app01的url.py</li></ul> <div class="language- extra-class"><pre class="language-text"><code>from django.conf.urls import include, re_path


urlpatterns = [

   re_path(r'^blog/', include('blog.urls')),
    re_path(&quot;^/&quot;,include('blog.urls'))
]
</code></pre></div><h2 id="模板"><a href="#模板" class="header-anchor">#</a> 模板</h2> <h3 id="深度变量的查找"><a href="#深度变量的查找" class="header-anchor">#</a> 深度变量的查找</h3> <ul><li>在 Django 模板中遍历复杂数据结构的关键是句点字符 (.)。</li> <li>列表-通过“点”＋索引，来取值</li> <li>字典-通<strong>过“点”****+</strong> <strong>键，来取值</strong></li> <li>不允许使用负数列表索引。 像｛｛ items.-1 ｝｝这样的模板变量将会引发 TemplateSyntaxError</li></ul> <div class="language- extra-class"><pre class="language-text"><code>   &lt;h4&gt;{{s}}&lt;/h4&gt;
   &lt;h4&gt;列表:{{ l.0 }}&lt;/h4&gt;
   &lt;h4&gt;列表:{{ l.2 }}&lt;/h4&gt;
   &lt;h4&gt;字典:{{ dic.name }}&lt;/h4&gt;
   &lt;h4&gt;日期:{{ date.year }}&lt;/h4&gt;
   &lt;h4&gt;类对象列表:{{ person_list.0.name }}&lt;/h4&gt;
注意：句点符也可以用来引用对象的方法(无参数方法)，这里调用方法时并* 没有* 使用圆括号 而且也无法给该方法传递参数；你只能调用不需参数的方法
&lt;h4&gt;字典:{{ dic.name.upper }}&lt;/h4&gt;
</code></pre></div><p><strong>模板渲染</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">import</span> datetime
   s<span class="token operator">=</span><span class="token string">&quot;hello&quot;</span>
   l<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">333</span><span class="token punctuation">]</span>    <span class="token comment"># 列表</span>
   dic<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;yuan&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">}</span>  <span class="token comment"># 字典</span>
   date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token number">1993</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>   <span class="token comment"># 日期对象</span>
   <span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
           self<span class="token punctuation">.</span>name<span class="token operator">=</span>name
   person_yuan<span class="token operator">=</span>Person<span class="token punctuation">(</span><span class="token string">&quot;yuan&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 自定义类对象</span>
   person_egon<span class="token operator">=</span>Person<span class="token punctuation">(</span><span class="token string">&quot;egon&quot;</span><span class="token punctuation">)</span>
   person_alex<span class="token operator">=</span>Person<span class="token punctuation">(</span><span class="token string">&quot;alex&quot;</span><span class="token punctuation">)</span>
   person_list<span class="token operator">=</span><span class="token punctuation">[</span>person_yuan<span class="token punctuation">,</span>person_egon<span class="token punctuation">,</span>person_alex<span class="token punctuation">]</span>
   <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;l&quot;</span><span class="token punctuation">:</span>l<span class="token punctuation">,</span><span class="token string">&quot;dic&quot;</span><span class="token punctuation">:</span>dic<span class="token punctuation">,</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">:</span>date<span class="token punctuation">,</span><span class="token string">&quot;person_list&quot;</span><span class="token punctuation">:</span>person_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token comment">#如果变量太多可以使用locals(),将当前页面上的所有变量按照字典的形式传入</span>
<span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span><span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>locals()</p> <p>它返回的字典对所有局部变量的名称与值进行映射，</p> <p>使用 locals() 时要注意是它将包括 <em>所有</em> 的局部变量，甚至包括request</p> <p>include 模板标签</p> <p><code>｛% include %｝</code>。该标签允许在（模板中）包含其它的模板的内容。 标签的参数是所要包含的模板名称，可以是一个变量，也可以是用单/双引号硬编码的字符串。 每当在多个模板中出现相同的代码时，就应该考虑是否要使用<code>｛% include %｝</code>来减少重复。</p> <h3 id="模板值与过滤器"><a href="#模板值与过滤器" class="header-anchor">#</a> 模板值与过滤器</h3> <blockquote><p><strong>对一个 Python开发者来说，写一个自己的模板语言就象是某种“成人礼”一样！ 如果你还没有完成一个自己的 模板语言，好好考虑写一个，这是一个非常有趣的锻炼。</strong></p></blockquote> <p>模板过滤器是在变量被显示前修改它的值的一个简单方法。<code>｛｛ name|lower ｝｝</code> 过滤器使用管道字符，</p> <p>过滤管道可以被 套接，一个过滤器管道的输出又可以作为下一个管道的输入</p> <p><code>｛｛ my_list|first|upper ｝｝</code>实现查找列表的第一个元素并将其转化为大写。</p> <p>过滤器可以传参数，过滤器的参数跟随冒号之后并且总是以双引号包含。</p> <p><code>｛｛ bio|truncatewords:&quot;30&quot; ｝｝</code></p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td>语法：</td> <td><code>｛｛obj\|filter__name:param｝｝</code></td></tr> <tr><td>Default</td> <td>如果一个变量是false或者为空，使用给定的默认值。否则，使用变量的值。例如： <code>｛｛ value|default:&quot;nothing&quot; ｝｝</code></td></tr> <tr><td>Length</td> <td>返回值的长度。它对字符串和列表都起作用。例如：<br><code>｛｛ value|length ｝｝</code><br>如果 value 是 ['a', 'b', 'c', 'd']，那么输出是 4。</td></tr> <tr><td>Filesizeformat</td> <td>将值格式化为一个 “人类可读的” 文件尺寸 （例如 '13 KB', '4.1 MB', '102 bytes', 等等）。例如：<br><code>｛｛ value|filesizeformat ｝｝</code><br>如果 value 是 123456789，输出将会是 117.7 MB。</td></tr> <tr><td>Date</td> <td>如果 value=datetime.datetime.now()<code>｛｛ value|date:&quot;Y-m-d&quot; ｝｝</code></td></tr> <tr><td>Slice</td> <td>如果 value=&quot;hello world&quot;<br><code>｛｛ value|slice:&quot;2:-1&quot; ｝｝</code></td></tr> <tr><td>Truncatechars</td> <td>如果字符串字符多于指定的字符数量，那么会被截断。截断的字符串将以可翻译的省略号序列（“...”）结尾。<br>**参数：**要截断的字符数<br>例如：<br><code>｛｛ value|truncatechars:9 ｝｝</code></td></tr> <tr><td>Safe</td> <td>Django的模板中会对HTML标签和JS等语法标签进行自动转义，原因显而易见，这样是为了安全。但是有的时候我们可能不希望这些HTML元素被转义，比如我们做一个内容管理系统，后台添加的文章中是经过修饰的，这些修饰可能是通过一个类似于FCKeditor编辑加注了HTML修饰符的文本，如果自动转义的话显示的就是保护HTML标签的源文件。为了在Django中关闭HTML的自动转义有两种方式，如果是一个单独的变量我们可以通过过滤器“|safe”的方式告诉Django这段代码是安全的不必转义。比如：<br>value=&quot;<a href="">点击</a>&quot;<br><code>｛｛ value\|safe｝｝</code></td></tr> <tr><td>addslashes :</td> <td>添加反斜杠到任何反斜杠、单引号或者双引号前面。 这在处理包含JavaScript的文本时是非常有用的。</td></tr></tbody></table> <h3 id="模板语法-标签"><a href="#模板语法-标签" class="header-anchor">#</a> 模板语法-标签</h3> <blockquote><p>标签看起来像是这样的： <code>｛% tag %｝</code>。标签比变量更加复杂：一些在输出中创建文本，一些通过循环或逻辑来控制流程，一些加载其后的变量将使用到的额外信息到模版中。一些标签需要开始和结束标签 （例如<code>｛% tag %｝</code> 标签 内容 <code>｛% endtag %｝</code>）。</p></blockquote> <h4 id="for标签"><a href="#for标签" class="header-anchor">#</a> for标签</h4> <p>多个for标签可以嵌套使用</p> <p>遍历每一个元素：</p> <div class="language- extra-class"><pre class="language-text"><code>{% for person in person_list %}
   &lt;p&gt;{{ person.name }}&lt;/p&gt;
{% endfor %}
</code></pre></div><p>给标签增加一个 <strong>reversed</strong> 使得该列表被反向迭代：</p> <div class="language- extra-class"><pre class="language-text"><code>{% for athlete in athlete_list reversed %}
...
{% endfor %}
</code></pre></div><p>遍历一个字典：</p> <div class="language- extra-class"><pre class="language-text"><code>{% for key,val in dic.items %}
   &lt;p&gt;{{ key }}:{{ val }}&lt;/p&gt;
{% endfor %}
</code></pre></div><h5 id="for-empty"><a href="#for-empty" class="header-anchor">#</a> for ... empty</h5> <p><strong>在执行循环之前先检测列表的大小是一个通常的做法，</strong> <strong>因为这种做法十分常见，所以<code>for</code> 标签支持一个可选的<code>｛% empty %｝</code> 分句，通过它我们可以定义当列表为空时的输出内容</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span>?标签带有一个可选的<span class="token punctuation">{</span><span class="token operator">%</span>?empty?<span class="token operator">%</span><span class="token punctuation">}</span>?从句，以便在给出的组是空的或者没有被找到时，可以有所操作。
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> person <span class="token keyword">in</span> person_list <span class="token operator">%</span><span class="token punctuation">}</span>
   <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> person<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> empty <span class="token operator">%</span><span class="token punctuation">}</span>
   <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>sorry<span class="token punctuation">,</span>no person here<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre></div><h5 id="forloop-模板变量"><a href="#forloop-模板变量" class="header-anchor">#</a> <strong><code>forloop</code> 模板变量</strong></h5> <p><strong>forloop</strong> 变量仅仅能够在循环中使用。 在模板解析器碰到<code>｛% endfor%｝</code>标签后，<strong>forloop</strong>就不可访问了。</p> <ul><li><p><strong>forloop.counter</strong> 总是一个表示当前循环的执行次数的整数计数器。 这个计数器是从1开始的，所以在第一次循环时 <strong>forloop.counter</strong> 将会被设置为1。</p> <div class="language- extra-class"><pre class="language-text"><code>{% for item in todo_list %}
    &lt;p&gt;{{ forloop.counter }}: {{ item }}&lt;/p&gt;
{% endfor %}
</code></pre></div></li> <li><p><code>forloop.counter0</code>类似于 forloop.counter ，但是它是从0计数的。 第一次执行循环时这个变量会被设置为0。</p></li> <li><p><code>forloop.revcounter</code> 是表示循环中剩余项的整型变量。 在循环初次执行时 forloop.revcounter 将被设置为序列中项的总数。 最后一次循环执行中，这个变量将被置1。</p></li> <li><p><code>forloop.revcounter0</code> 类似于 forloop.revcounter ，但它以0做为结束索引。 在第一次执行循环时，该变量会被置为序列的项的个数减1。</p></li> <li><p><code>forloop.first</code> 是一个布尔值，如果该迭代是第一次执行，那么它被置为```` 在下面的情形中这个变量是很有用的：</p> <div class="language- extra-class"><pre class="language-text"><code>{% for object in objects %}
    {% if forloop.first %}&lt;li class=&quot;first&quot;&gt;{% else %}&lt;li&gt;{% endif %}
    {{ object }}
    &lt;/li&gt;
{% endfor %}
</code></pre></div><p><code>forloop.last</code> 是一个布尔值；在最后一次执行循环时被置为True。 一个常见的用法是在一系列的链接之间放置管道符（|）</p> <div class="language- extra-class"><pre class="language-text"><code>{% for link in links %}{{ link }}{% if not forloop.last %} | {% endif %}{% endfor %}
</code></pre></div><p>上面的模板可能会产生如下的结果：Link1 | Link2 | Link3 | Link4</p> <p>另一个常见的用途是为列表的每个单词的加上逗号。</p> <div class="language- extra-class"><pre class="language-text"><code>{% for p in places %}{{ p }}{% if not forloop.last %}, {% endif %}{% endfor %}
</code></pre></div><p><code>forloop.parentloop</code> <strong>是一个指向当前循环的上一级循环的</strong> <strong>forloop</strong> <strong>对象的引用（在嵌套循环的情况下）</strong></p> <div class="language- extra-class"><pre class="language-text"><code>{% for country in countries %}
    &lt;table&gt;
    {% for city in country.city_list %}
        &lt;tr&gt;
        &lt;td&gt;Country #{{ forloop.parentloop.counter }}&lt;/td&gt;
        &lt;td&gt;City #{{ forloop.counter }}&lt;/td&gt;
        &lt;td&gt;{{ city }}&lt;/td&gt;
        &lt;/tr&gt;
    {% endfor %}
    &lt;/table&gt;
{% endfor %}
</code></pre></div></li></ul> <h4 id="ifequal-ifnotequal"><a href="#ifequal-ifnotequal" class="header-anchor">#</a> <strong>ifequal/ifnotequal</strong></h4> <p><code>｛% ifequal %｝</code> <strong>标签比较两个值，当他们相等时，显示在</strong><code>｛% ifequal %｝</code> <strong>和</strong>``｛% end ifequal %｝`<strong>之中所有的值。</strong></p> <div class="language- extra-class"><pre class="language-text"><code>{% ifequal user currentuser %}
    &lt;h1&gt;Welcome!&lt;/h1&gt;
{% endifequal %}

参数可以是硬编码的字符串，随便用单引号或者双引号引起来
{% ifequal section 'sitenews' %}
    &lt;h1&gt;Site News&lt;/h1&gt;
{% endifequal %}

{% ifequal section &quot;community&quot; %}
    &lt;h1&gt;Community&lt;/h1&gt;
{% endifequal %}
</code></pre></div><p>和<code>｛% if %｝</code> 类似， <code>｛% ifequal %｝</code>支持可选的 <code>｛% else%｝</code> 标签</p> <div class="language- extra-class"><pre class="language-text"><code>{% ifequal section 'sitenews' %}
    &lt;h1&gt;Site News&lt;/h1&gt;
{% else %}
    &lt;h1&gt;No News Here&lt;/h1&gt;
{% endifequal %}
</code></pre></div><p>只有模板变量，字符串，整数和小数可以作为<code>｛% ifequal %｝</code>标签的参数</p> <h4 id="if-else"><a href="#if-else" class="header-anchor">#</a> <strong>if/else</strong></h4> <p><code>｛%if%｝</code>标签检查(evaluate)一个变量，如果这个变量为真（即，变量存在，非空，不是布尔值假），系统会显示在  <code>｛%if%｝</code>和 <code>｛% endif%｝</code>之间的任何内容，</p> <div class="language- extra-class"><pre class="language-text"><code>{% if today_is_weekend %}
    &lt;p&gt;Welcome to the weekend!&lt;/p&gt;
{% endif %}
</code></pre></div><p><code>｛% else %｝</code> 标签是可选的：</p> <div class="language- extra-class"><pre class="language-text"><code>{% if today_is_weekend %}
    &lt;p&gt;Welcome to the weekend!&lt;/p&gt;
{% else %}
    &lt;p&gt;Get back to work.&lt;/p&gt;
{% endif %}
</code></pre></div><p><code>｛% if %｝</code> 标签接受 and ， or 或者 not 关键字来对多个变量做判断 ，或者对变量取反（ not )</p> <p><code>｛% if %｝</code>标签不允许在同一个标签中同时使用 <strong>and</strong> 和 <strong>or</strong> ，因为逻辑上可能模糊的</p> <div class="language- extra-class"><pre class="language-text"><code>{% if athlete_list and coach_list or cheerleader_list %}
</code></pre></div><p>注意: 系统不支持用圆括号来组合比较操作</p> <h4 id="with"><a href="#with" class="header-anchor">#</a> With</h4> <p>使用一个简单地名字缓存一个复杂的变量，当你需要使用一个“昂贵的”方法（比如访问数据库）很多次的时候是非常有用的</p> <div class="language- extra-class"><pre class="language-text"><code>{% with total=business.employees.count %}
   {{ total }} employee{{ total|pluralize }}
{% endwith %
</code></pre></div><h4 id="csrf-token"><a href="#csrf-token" class="header-anchor">#</a> csrf_token</h4> <p>这个标签用于跨站请求伪造保护</p> <p>不想让别人随意给这个服务器发送post请求可以在form标签内部加上<code>｛｛csrf_token｝｝</code></p> <p>rander将<code>｛｛csrf_token｝｝</code>标签渲染为一个type=hidden的input标签，在点击post提交请求时，会多提交一个键值对，Django的中间件会根据这个键值对来确定访问的安全性</p> <h3 id="自定义标签与过滤器"><a href="#自定义标签与过滤器" class="header-anchor">#</a> 自定义标签与过滤器</h3> <blockquote><p>自定义的过滤器只能传两个参数，而标签可以传多个</p></blockquote> <h4 id="自定义过滤器"><a href="#自定义过滤器" class="header-anchor">#</a> 自定义过滤器</h4> <ol><li><p>在settings中的INSTALLED_APPS配置当前app，不然django无法找到自定义的simple_tag.</p></li> <li><p>在app中创建templatetags模块(模块名<code>只能是templatetags</code>)</p></li> <li><p>创建任意 <strong>.py</strong> 文件，如：my_tags.py|</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django <span class="token keyword">import</span> template
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>safestring <span class="token keyword">import</span> mark_safe

register <span class="token operator">=</span> template<span class="token punctuation">.</span>Library<span class="token punctuation">(</span><span class="token punctuation">)</span>?? <span class="token comment">#register的名字是固定的,不可改变</span>
<span class="token decorator annotation punctuation">@register<span class="token punctuation">.</span>filter</span>
<span class="token keyword">def</span> <span class="token function">filter_multi</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span>v2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span>? v1 <span class="token operator">*</span> v2
<span class="token decorator annotation punctuation">@register<span class="token punctuation">.</span>simple_tag</span>
<span class="token keyword">def</span> <span class="token function">simple_tag_multi</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span>v2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span>? v1 <span class="token operator">*</span> v2

<span class="token decorator annotation punctuation">@register<span class="token punctuation">.</span>simple_tag</span>
<span class="token keyword">def</span> <span class="token function">my_input</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token string">&quot;&lt;input type='text' id='%s' class='%s' /&gt;&quot;</span> <span class="token operator">%</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span>arg<span class="token punctuation">,</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> mark_safe<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>在使用自定义simple_tag和filter的html文件中导入之前创建的my_tags.py <code>｛% load my_tags %｝</code></p></li> <li><p>使用simple_tag和filter（如何调用)</p> <div class="language- extra-class"><pre class="language-text"><code>----.html
{% load xxx %}
# num=12
{{ num|filter_multi:2 }} #24
{{ num|filter_multi:&quot;[22,333,4444]&quot; }}
{% simple_tag_multi 2 5 %}? 参数不限,但不能放在if for语句中
{% simple_tag_multi num 5 %}
</code></pre></div></li></ol> <p>注意：filter可以用在if等语句后，simple_tag不可以</p> <h3 id="注释"><a href="#注释" class="header-anchor">#</a> <strong>注释</strong></h3> <p>单行注释,使用 {# #}，</p> <p><code>{# This is a comment #}</code></p> <p>多行注释，可以使用<code>｛% comment %｝</code> 模板标签，</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">{</span><span class="token operator">%</span> comment <span class="token operator">%</span><span class="token punctuation">}</span>
This <span class="token keyword">is</span> a
multi<span class="token operator">-</span>line comment<span class="token punctuation">.</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endcomment <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre></div><p>模板-继承</p> <ol><li>创建 base.html 模板，在其中定义站点的主要外观感受。 这些都是不常修改甚至从不修改的部分。</li> <li>为网站的每个区域创建 base_SECTION.html 模板(例如, base_photos.html 和 base_forum.html )。这些模板对 base.html 进行拓展，并包含区域特定的风格与设计。</li> <li>为每种类型的页面创建独立的模板，例如论坛页面或者图片库。 这些模板拓展相应的区域模板。</li></ol> <p>第一步定义 <em>基础模板</em> base.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">HTML</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//W3C//DTD HTML 4.01//EN&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>{% block title %}{% endblock %}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>My helpful timestamp site<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
{% block content %}{% endblock %}
{% block footer %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Thanks for visiting my site.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>     默认显示，
{% endblock %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>｛% block %｝ ｛% endblock %｝</code> 标签告诉模板引擎，子模板可以重载这些部分</p> <p>第二步,调用继承模板 <code>｛% extends &quot;base.html&quot; %｝</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">{</span><span class="token operator">%</span> extends <span class="token string">&quot;base.html&quot;</span> <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token operator">%</span> block title <span class="token operator">%</span><span class="token punctuation">}</span>The current time<span class="token punctuation">{</span><span class="token operator">%</span> endblock <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token operator">%</span> block content <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>It <span class="token keyword">is</span> now <span class="token punctuation">{</span><span class="token punctuation">{</span> current_date <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endblock <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre></div><p>注意</p> <p><code>｛% extends %｝</code> ，必须保证其为模板中的第一个模板标记</p> <p><code>｛｛ block.super ｝｝</code>访问父模板中的块的内容，  当只想在上级代码块基础上添加内容，而不是全部重载，</p> <h2 id="模型"><a href="#模型" class="header-anchor">#</a> 模型</h2> <p>在视图中查询数据库的笨方法,通过pymysql进行</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render_to_response
<span class="token keyword">import</span> MySQLdb
<span class="token keyword">def</span> <span class="token function">book_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
   db <span class="token operator">=</span> MySQLdb<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>user<span class="token operator">=</span><span class="token string">'me'</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token string">'mydb'</span><span class="token punctuation">,</span> passwd<span class="token operator">=</span><span class="token string">'secret'</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">)</span>
   cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT name FROM books ORDER BY name'</span><span class="token punctuation">)</span>
   names <span class="token operator">=</span> <span class="token punctuation">[</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
   db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> render_to_response<span class="token punctuation">(</span><span class="token string">'book_list.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'names'</span><span class="token punctuation">:</span> names<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h3> <p>setting 配置</p> <div class="language-python extra-class"><pre class="language-python"><code>DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
       <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>
       <span class="token string">'NAME'</span><span class="token punctuation">:</span><span class="token string">'bms'</span><span class="token punctuation">,</span>       <span class="token comment"># 要连接的数据库，连接前需要创建好</span>
       <span class="token string">'USER'</span><span class="token punctuation">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>  <span class="token comment"># 连接数据库的用户名</span>
       <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment"># 连接数据库的密码</span>
       <span class="token string">'HOST'</span><span class="token punctuation">:</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>       <span class="token comment"># 连接主机，默认本级</span>
       <span class="token string">'PORT'</span>：<span class="token number">3306</span>         <span class="token comment">#  端口 默认3306</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注意1</strong></p> <p>报错：no module named MySQLdb   ,python 2 与python3的兼容</p> <p>解决: 找到项目名文件下的__init__,在里面写入：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pymysql
pymysql<span class="token punctuation">.</span>install_as_MySQLdb<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>注意2</strong></p> <p>确保配置文件中的INSTALLED_APPS中写入我们创建的app名称</p> <p><strong>注意3</strong></p> <p>如果报错如下：</p> <div class="language-python extra-class"><pre class="language-python"><code>django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ImproperlyConfigured<span class="token punctuation">:</span> mysqlclient <span class="token number">1.3</span><span class="token number">.3</span> <span class="token keyword">or</span> newer <span class="token keyword">is</span> required<span class="token punctuation">;</span> you have <span class="token number">0.7</span><span class="token number">.11</span><span class="token punctuation">.</span><span class="token boolean">None</span>
</code></pre></div><p>MySQLclient目前只支持到python3.4，因此如果使用的更高版本的python，需要修改如下：</p> <p>通过查找路径C:\Programs\Python\Python36-32\Lib\site-packages\Django-2.0-py3.6.egg\django\db\backends\mysql这个路径里的文件,注掉下列代码</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">if</span> version <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">raise</span> ImproperlyConfigured<span class="token punctuation">(</span><span class="token string">&quot;mysqlclient 1.3.3 or newer is required; you have %s&quot;</span> <span class="token operator">%</span> Database<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
</code></pre></div><p><strong>注意4</strong></p> <p>如果想打印orm转换过程中的sql，需要在settings中进行如下配置：</p> <div class="language-python extra-class"><pre class="language-python"><code>LOGGING <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">'version'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
   <span class="token string">'disable_existing_loggers'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
   <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
       <span class="token string">'console'</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
           <span class="token string">'level'</span><span class="token punctuation">:</span><span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
           <span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'logging.StreamHandler'</span><span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token string">'loggers'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
       <span class="token string">'django.db.backends'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
           <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'console'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string">'propagate'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
           <span class="token string">'level'</span><span class="token punctuation">:</span><span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>迁移数据库</p> <div class="language-python extra-class"><pre class="language-python"><code>python manage<span class="token punctuation">.</span>py makemigrations
python manage<span class="token punctuation">.</span>py migrate
</code></pre></div><h3 id="单表"><a href="#单表" class="header-anchor">#</a> 单表</h3> <p>要调用的模块</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse
<span class="token keyword">from</span> app01<span class="token punctuation">.</span>models <span class="token keyword">import</span> Book
</code></pre></div><h4 id="增加"><a href="#增加" class="header-anchor">#</a> 增加</h4> <p>方式一</p> <blockquote><p>直接在模型中传入要增加的每一个键值</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    book_obj<span class="token operator">=</span>Book<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>title<span class="token operator">=</span><span class="token string">&quot;python红宝书&quot;</span><span class="token punctuation">,</span>price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>pub_date<span class="token operator">=</span><span class="token string">&quot;2012-12-12&quot;</span><span class="token punctuation">,</span>publish<span class="token operator">=</span><span class="token string">&quot;人民出版社&quot;</span><span class="token punctuation">)</span>
    book_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>方式二:</p> <blockquote><p>通过create方法,同时create返回值就是当前生成的对象纪录</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    book_obj<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;php2&quot;</span><span class="token punctuation">,</span>price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>pub_date<span class="token operator">=</span><span class="token string">&quot;2013-12-12&quot;</span><span class="token punctuation">,</span>publish<span class="token operator">=</span><span class="token string">&quot;人民出版社&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>pub_date<span class="token punctuation">)</span>
</code></pre></div><p>批量插入</p> <div class="language-python extra-class"><pre class="language-python"><code>book_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    book<span class="token operator">=</span>Book<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;book_%s&quot;</span><span class="token operator">%</span>i<span class="token punctuation">,</span>price<span class="token operator">=</span>i<span class="token operator">*</span>i<span class="token punctuation">)</span>
    book_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>book<span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>bulk_create<span class="token punctuation">(</span>book_list<span class="token punctuation">)</span>
</code></pre></div><h4 id="查询"><a href="#查询" class="header-anchor">#</a> 查询</h4> <h5 id="all"><a href="#all" class="header-anchor">#</a> all</h5> <blockquote><p>查询所有结果,返回一个queryset对象</p> <p><code>book_list=Book.objects.all()</code>    返回一个queryset列表</p></blockquote> <h5 id="first-last"><a href="#first-last" class="header-anchor">#</a> first,last :</h5> <blockquote><p>返回第一条，最后一条记录,  调用者:queryset对象  返回值:model对象</p> <p><code>book=Book.objects.all().first() book=Book.objects.all()[0]</code></p></blockquote> <h5 id="filter"><a href="#filter" class="header-anchor">#</a> filter</h5> <blockquote><p>它包含了与所给筛选条件相匹配的对象,返回值:queryset对象</p> <p><code>book_list=Book.objects.filter(price=100) book_obj=Book.objects.filter(price=100).first()</code></p></blockquote> <h5 id="get"><a href="#get" class="header-anchor">#</a> get</h5> <blockquote><p>返回与所给筛选条件相匹配的对象，返回结果有且只有一个，如果符合筛选条件的对象超过一个或者没有都会抛出错误 有且只有一个查询结果时才有意义,返回值:model对象</p> <p><code>book_obj=Book.objects.get(title=&quot;go&quot;) book_obj=Book.objects.get(price=100)</code></p></blockquote> <h5 id="exclude"><a href="#exclude" class="header-anchor">#</a> exclude</h5> <blockquote><p>它包含了与所给筛选条件不匹配的对象,返回值:queryset对象</p> <p><code>ret=Book.objects.exclude(title=&quot;go&quot;)</code></p></blockquote> <h5 id="order-by"><a href="#order-by" class="header-anchor">#</a> order_by</h5> <blockquote><p>对查询结果排序
调用者: queryset对象   返回值:  queryset对象</p> <p><code>ret=Book.objects.all().order_by(&quot;-id&quot;) -id加了一个负号，表示降序 ret=Book.objects.all().order_by(&quot;price&quot;,&quot;id&quot;)</code></p></blockquote> <h5 id="count"><a href="#count" class="header-anchor">#</a> count</h5> <blockquote><p>返回数据库中匹配查询(QuerySet)的对象数量
调用者: queryset对象   返回值: int
<code>ret=Book.objects.all().count()</code></p></blockquote> <h5 id="exist"><a href="#exist" class="header-anchor">#</a> exist</h5> <blockquote><p><code>ret=Book.objects.all().exists()</code>  返回一个布尔值</p></blockquote> <h5 id="values"><a href="#values" class="header-anchor">#</a> values</h5> <blockquote><p>方法  返回一个ValueQuerySet——一个特殊的QuerySet，运行后得到的并不是一系列，model的实例化对象，而是一个可迭代的字典序列,调用者: queryset对象  返回值:queryset对象
<code>ret=Book.objects.all().values(&quot;price&quot;,&quot;title&quot;)</code></p></blockquote> <h5 id="values-list"><a href="#values-list" class="header-anchor">#</a> values_list</h5> <blockquote><p>方法   它与values()非常相似，它返回的是一个元组序列，values返回的是一个字典序列
调用者: queryset对象  返回值:queryset对象，相当于没有键只有值
<code>ret=Book.objects.all().values_list(&quot;price&quot;,&quot;title&quot;)</code> <code>print(ret)</code>       #&lt;QuerySet [(Decimal('100.00'),), (Decimal('100.00'),), (Decimal('200.00'),)]&gt;</p></blockquote> <h5 id="distinct"><a href="#distinct" class="header-anchor">#</a> distinct</h5> <blockquote><p>去重   从返回结果中剔除重复纪录
<code>ret=Book.objects.all().distinct() ret=Book.objects.all().values(&quot;price&quot;).distinct() Book.objects.all().filter().order_by().filter().reverse().first()</code></p></blockquote> <h4 id="模糊查询"><a href="#模糊查询" class="header-anchor">#</a> 模糊查询</h4> <h5 id="gt-lt"><a href="#gt-lt" class="header-anchor">#</a> gt,lt</h5> <blockquote><p>大于--gt，小于--lt</p> <p><code>ret=Book.objects.filter(price__gt=10,price__lt=200)</code></p></blockquote> <h5 id="startswith"><a href="#startswith" class="header-anchor">#</a> startswith</h5> <blockquote><p>以什么开头</p> <p><code>ret=Book.objects.filter(title__startswith=&quot;p&quot;)</code></p></blockquote> <h5 id="contains"><a href="#contains" class="header-anchor">#</a> contains</h5> <blockquote><p>包含</p> <p><code>ret=Book.objects.filter(title__contains=&quot;h&quot;)</code></p></blockquote> <h5 id="icontains"><a href="#icontains" class="header-anchor">#</a> icontains</h5> <blockquote><p>包含忽略大小写</p> <p><code>ret=Book.objects.filter(title__icontains=&quot;h&quot;)</code></p></blockquote> <h5 id="in"><a href="#in" class="header-anchor">#</a> in</h5> <blockquote><p>在给定的选择内</p> <p><code>ret=Book.objects.filter(price__in=[200,300])</code></p></blockquote> <h5 id="主键"><a href="#主键" class="header-anchor">#</a> 主键</h5> <blockquote><p>Model.pk    pk代表主键</p></blockquote> <h5 id="时间允许精确到年月日"><a href="#时间允许精确到年月日" class="header-anchor">#</a> 时间允许精确到年月日</h5> <blockquote><p>​    ret=Book.objects.filter(pub_date__year=2018,pub_date__month=5)
​    print(ret)</p></blockquote> <p><strong>例子</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__in<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__gt<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__lt<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title__contains<span class="token operator">=</span><span class="token string">&quot;python&quot;</span><span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title__icontains<span class="token operator">=</span><span class="token string">&quot;python&quot;</span><span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title__startswith<span class="token operator">=</span><span class="token string">&quot;py&quot;</span><span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span><span class="token number">2012</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="删除、更新记录"><a href="#删除、更新记录" class="header-anchor">#</a> 删除、更新记录</h4> <p>delete()。它运行时立即删除对象而不返回任何值。例如：model_obj.delete()</p> <p>一次性删除多个对象</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span><span class="token number">2005</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>同时删除外键</p> <blockquote><p>在 Django 删除对象时，会模仿 SQL 约束 ON DELETE CASCADE 的行为，换句话说，删除一个对象时也会删除与它相关联的外键对象。例如：</p></blockquote> <p>防止误删</p> <p><strong>delete() 方法是 QuerySet 上的方法，但并不适用于 Manager 本身</strong></p> <p>**是为了避免意外地调用 Entry.objects.delete() 方法导致 所有的 记录被误删除。**如果你确认要删除所有的对象，那么你必须显式地调用：</p> <p>**如果不想级联删除，可以设置为:**pubHouse = models.ForeignKey(to='Publisher', on_delete=models.SET_NULL, blank=True, null=True)</p> <div class="language-python extra-class"><pre class="language-python"><code>删除纪录   先查再删
delete<span class="token punctuation">:</span> 调用者<span class="token punctuation">:</span> queryset对象  model对象
ret<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>

修改纪录
update <span class="token punctuation">:</span>  调用者<span class="token punctuation">:</span> queryset对象
ret<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;php2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;php&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="多表"><a href="#多表" class="header-anchor">#</a> 多表</h3> <h4 id="模型创建"><a href="#模型创建" class="header-anchor">#</a> 模型创建</h4> <p>一对多</p> <blockquote><p>在<code>多</code>对应的表中创建关联（外键）字段</p></blockquote> <p>多对多</p> <blockquote><p>创建第三张表（关联表）：id 和两个关联字段，\</p> <p><code>ManyToManyField</code>可以建在两个模型中的任意一个，自动创建第三张表</p></blockquote> <p>一对一</p> <blockquote><p>在两张表中的<code>任意一张表</code>中建立关联字段+Unique</p></blockquote> <p>外键约束</p> <p>防止出现脏数据，删除一个字段时会提示是否有关联的字段</p> <p>创建关联字段，就尽量把约束加上</p> <p>注意事项</p> <ul><li>表的名称myapp_modelName，是根据 模型中的元数据自动生成的，也可以覆写为别的名称</li> <li>id 字段是自动添加的</li> <li>对于外键字段，Django 会在字段名上添加&quot;<em>id&quot; 来创建数据库中的列名</em></li> <li><em>这个例子中的CREATE TABLE SQL 语句使用PostgreSQL 语法格式，要注意的是Django 会根据settings 中指定的数据库类型来使用相应的SQL 语句。</em></li> <li>_定义好模型之后，你需要告诉Django _使用_这些模型。你要做的就是修改配置文件中的INSTALL_APPSZ中设置，在其中添加models.py所在应用的名称。</li> <li>外键字段 ForeignKey 有一个 null=True 的设置(它允许外键接受空值 NULL)，你可以赋给它空值 None</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>  <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        unique_together <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">(</span><span class="token string">'article'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
</code></pre></div><h4 id="多表操作"><a href="#多表操作" class="header-anchor">#</a> 多表操作</h4> <h5 id="绑定关系"><a href="#绑定关系" class="header-anchor">#</a> 绑定关系</h5> <p>绑定一对多</p> <p>方式1:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#为book表绑定出版社: book  ---    publish</span>
book_obj<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;红楼梦&quot;</span><span class="token punctuation">,</span>price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>publishDate<span class="token operator">=</span><span class="token string">&quot;2012-12-12&quot;</span><span class="token punctuation">,</span>publish_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
</code></pre></div><p>方式2:</p> <div class="language-python extra-class"><pre class="language-python"><code>pub_obj<span class="token operator">=</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>nid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
book_obj<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;三国演绎&quot;</span><span class="token punctuation">,</span>price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>publishDate<span class="token operator">=</span><span class="token string">&quot;2012-12-12&quot;</span><span class="token punctuation">,</span>publish<span class="token operator">=</span>pub_obj<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publishDate<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish<span class="token punctuation">)</span>       <span class="token comment">#  与这本书籍关联的出版社对象</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish_id<span class="token punctuation">)</span>

<span class="token comment">#查询西游记的出版社对应的邮箱</span>
book_obj<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;西游记&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
</code></pre></div><p>绑定多对多</p> <div class="language-python extra-class"><pre class="language-python"><code> book_obj<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;金瓶梅&quot;</span><span class="token punctuation">,</span>price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>publishDate<span class="token operator">=</span><span class="token string">&quot;2012-12-12&quot;</span><span class="token punctuation">,</span>publish_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    egon<span class="token operator">=</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;egon&quot;</span><span class="token punctuation">)</span>
    alex<span class="token operator">=</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;alex&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">#绑定多对多关系的API</span>
    book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>add<span class="token punctuation">(</span>egon<span class="token punctuation">,</span>alex<span class="token punctuation">)</span>
    book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
    book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>解除多对多关系</p> <div class="language-python extra-class"><pre class="language-python"><code>book<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>nid<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
book<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">#book.authors.remove(*[1,2])</span>
book<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="跨表查询"><a href="#跨表查询" class="header-anchor">#</a> 跨表查询</h4> <h5 id="基于对象的跨表查询-子查询"><a href="#基于对象的跨表查询-子查询" class="header-anchor">#</a> <strong>基于对象的跨表查询</strong>(子查询)</h5> <blockquote><p>正向查询按字段,反向查询按表名</p></blockquote> <p><strong>一对多</strong></p> <p>正向查询(<code>按字段</code>：publish)：</p> <div class="language-python extra-class"><pre class="language-python"><code>    <span class="token comment"># 查询主键为1的书籍的出版社所在的城市</span>
    book_obj<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># book_obj.publish 是主键为1的书籍对象关联的出版社对象</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>city<span class="token punctuation">)</span> 　

 对应sql<span class="token punctuation">:</span>
    select publish_id <span class="token keyword">from</span> Book where pk<span class="token operator">=</span><span class="token string">&quot;1&quot;</span>
    select name <span class="token keyword">from</span> Publish where <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre></div><p>反向查询(<code>按表名</code>：book_set)：</p> <div class="language-python extra-class"><pre class="language-python"><code>    <span class="token comment">#查询人民出版社出版过的书籍名称</span>
    publish<span class="token operator">=</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;人民出版社&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ret<span class="token operator">=</span>publish<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
</code></pre></div><p><strong>一对一查询</strong></p> <p>正向查询 :</p> <div class="language- extra-class"><pre class="language-text"><code> 查询alex的手机号  
 alex=Author.objects.filter(name=&quot;alex&quot;).first()
    print(alex.authordetail.telephone)
</code></pre></div><p>反向查询 :</p> <div class="language- extra-class"><pre class="language-text"><code>查询手机号为110的作者的名字和年龄
     ad=AuthorDetail.objects.filter(telephone=&quot;110&quot;).first()
    print(ad.author.name)
    print(ad.author.age)
</code></pre></div><p><strong>多对多</strong></p> <p>正向查询 :</p> <div class="language-python extra-class"><pre class="language-python"><code>查询金瓶梅这本书的所有作者的名字
    book_obj<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;金瓶梅&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    author_list<span class="token operator">=</span>book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># queryset对象  [author_obj1,...]</span>
    
    <span class="token keyword">for</span> author <span class="token keyword">in</span> author_list<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>author<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre></div><p>反向查询</p> <div class="language- extra-class"><pre class="language-text"><code>查询alex出版过的所有书籍名称
  alex=Author.objects.filter(name=&quot;alex&quot;).first()
    book_list=alex.book_set.all()
    for book in book_list:
        print(book.title)
</code></pre></div><h5 id="基于双下划线的跨表查询-join查询"><a href="#基于双下划线的跨表查询-join查询" class="header-anchor">#</a> 基于双下划线的跨表查询(join查询)</h5> <blockquote><p>规则：正向查询按字段,反向查询按表名小写用来告诉ORM引擎join哪张表</p></blockquote> <p>一对多</p> <div class="language- extra-class"><pre class="language-text"><code>查询金瓶梅这本书的出版社的名字
    方式1:
    ret=Book.objects.filter(title=&quot;金瓶梅&quot;).values(&quot;publish__name&quot;)
    print(ret) # &lt;QuerySet [{'publish__name': '南京出版社'}]&gt;
    方式2:
    ret=Publish.objects.filter(book__title=&quot;金瓶梅&quot;).values(&quot;name&quot;)
    print(ret)
</code></pre></div><p>多对多</p> <div class="language- extra-class"><pre class="language-text"><code>查询金瓶梅这本书的所有作者的名字
   方式1:
    需求: 通过Book表join与其关联的Author表,属于正向查询:按字段authors通知ORM引擎join book_authors与author
    ret=Book.objects.filter(title=&quot;金瓶梅&quot;).values(&quot;authors__name&quot;)
    print(ret) # &lt;QuerySet [{'authors__name': 'alex'}, {'authors__name': 'egon'}]&gt;

    方式2:
    需求: 通过Author表join与其关联的Book表,属于反向查询:按表名小写book通知ORM引擎join book_authors与book表
    ret=Author.objects.filter(book__title=&quot;金瓶梅&quot;).values(&quot;name&quot;)
    print(ret) # &lt;QuerySet [{'name': 'alex'}, {'name': 'egon'}]&gt;
</code></pre></div><p>一对一</p> <div class="language- extra-class"><pre class="language-text"><code>方式1:
需求: 通过Author表join与其关联的AuthorDetail表,属于正向查询:按字段authordetail通知ORM引擎join Authordetail表
ret=Author.objects.filter(name=&quot;alex&quot;).values(&quot;authordetail__telephone&quot;)
print(ret) # &lt;QuerySet [{'authordetail__telephone': 110}]&gt;

方式2:
需求: 通过AuthorDetail表join与其关联的Author表,属于反向查询:按表名小写author通知ORM引擎join Author表
ret=AuthorDetail.objects.filter(author__name=&quot;alex&quot;).values(&quot;telephone&quot;)
print(ret) # &lt;QuerySet [{'telephone': 110}]&gt;
</code></pre></div><p>聚合查询</p> <blockquote><p><code>aggregate</code>,返回值是一个字典,不再是queryset</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 查询所有书籍的平均价格</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Avg<span class="token punctuation">,</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Count
ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>avg_price<span class="token operator">=</span>Avg<span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> max_price<span class="token operator">=</span>Max<span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment"># {'avg_price': 151.0, 'max_price': Decimal('301.00')}</span>
</code></pre></div><p>分组查询</p> <blockquote><p><code>annotate</code> ,  返回值依然是queryset</p></blockquote> <p>单表分组查询</p> <p>单表分组查询的ORM语法: 单表模型.objects.values(&quot;group by的字段&quot;).annotate(聚合函数(&quot;统计字段&quot;))</p> <div class="language-python extra-class"><pre class="language-python"><code>示例<span class="token number">1</span>
<span class="token comment"># 查询每一个部门的名称以及员工的平均薪水</span>
select dep<span class="token punctuation">,</span>Avg<span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">from</span> emp group by dep
ret<span class="token operator">=</span>Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;dep&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>avg_salary<span class="token operator">=</span>Avg<span class="token punctuation">(</span><span class="token string">&quot;salary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> 
<span class="token comment"># &lt;QuerySet [{'avg_salary': 5000.0, 'dep': '保安部'}, {'avg_salary': 51000.0, 'dep': '教学部'}]&gt;</span>

示例<span class="token number">2</span>
<span class="token comment"># 查询每一个省份的名称以及员工数</span>
ret<span class="token operator">=</span>Emp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;province&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>c<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token comment"># &lt;QuerySet [{'province': '山东省', 'c': 2}, {'province': '河北省', 'c': 1}]&gt;</span>
</code></pre></div><p>多表分组查询</p> <div class="language-python extra-class"><pre class="language-python"><code>示例<span class="token number">1</span> 查询每一个出版社的名称以及出版的书籍个数   
ret <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;nid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>c<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">&quot;book__title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'nid': 1, 'c': 3}, {'nid': 2, 'c': 1}]&gt;</span>

ret <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>c<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">&quot;book__title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'name': '人民出版社', 'c': 3}, {'name': '南京出版社', 'c': 1}]&gt;</span>

ret <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;nid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>c<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">&quot;book__title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'name': '人民出版社', 'c': 3}, {'name': '南京出版社', 'c': 1}]&gt;</span>

示例<span class="token number">2</span> 查询每一个作者的名字以及出版过的书籍的最高价格
ret <span class="token operator">=</span> Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;pk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>max_price<span class="token operator">=</span>Max<span class="token punctuation">(</span><span class="token string">&quot;book__price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;max_price&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>

示例<span class="token number">3</span> 查询每一个书籍的名称以及对应的作者个数
ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;pk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>c<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">&quot;authors__name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
</code></pre></div><p><strong>总结 跨表的分组查询的模型:</strong></p> <p>每一个后表模型.objects.values(&quot;pk&quot;).annotate(聚合函数(关联表__统计字段))</p> <p><strong>跨表分组查询的另一种玩法</strong></p> <div class="language- extra-class"><pre class="language-text"><code>示例1 查询每一个出版社的名称以及出版的书籍个数
ret=Publish.objects.values(&quot;nid&quot;).annotate(c=Count(&quot;book__title&quot;)).values(&quot;name&quot;,&quot;email&quot;,&quot;c&quot;)
ret=Publish.objects.all().annotate(c=Count(&quot;book__title&quot;)).values(&quot;name&quot;,&quot;c&quot;,&quot;city&quot;)
ret=Publish.objects.annotate(c=Count(&quot;book__title&quot;)).values(&quot;name&quot;,&quot;c&quot;,&quot;city&quot;)
print(ret)
</code></pre></div><h2 id="django-ajax"><a href="#django-ajax" class="header-anchor">#</a> django-ajax</h2> <p><img src="https://leiyiming.oss-cn-shenzhen.aliyuncs.com/img/image-20200626152815669.png" alt="image-20200626152815669"></p> <p>优点：</p> <p>AJAX使用Javascript技术向服务器发送异步请求</p> <p>AJAX无须刷新整个页面</p> <p><strong>基于jquery的Ajax实现</strong></p> <blockquote><p>form 通过input的name属性，来组装键值对,而Ajax，通过jQuery获取input的id值来组装,注意<code>forbidde</code></p></blockquote> <p>实现</p> <p>文件上传</p> <p>一、请求头ContentType</p> <p>ContentType指的是请求体的编码类型，常见的类型共有3种：</p> <ol><li><p>application/x-www-form-urlencoded
这应该是最常见的 POST 提交数据的方式了。浏览器的原生表单，如果不设置 enctype 属性，那么最终就会以 application/x-www-form-urlencoded 方式提交数据。请求类似于下面这样（无关的请求头在本文中都省略掉了）</p> <div class="language- extra-class"><pre class="language-text"><code>POST http://www.example.com HTTP/1.1
Content-Type: application/x-www-form-urlencoded;charset=utf-8

user=yuan&amp;age=22
</code></pre></div></li> <li><p>multipart/form-data
这又是一个常见的 POST 数据提交的方式。我们使用表单上传文件时，必须让表单的 enctype 等于 multipart/form-data。直接来看一个请求示例：</p> <div class="language- extra-class"><pre class="language-text"><code>POST http://www.example.com HTTP/1.1
Content-Type:multipart/form-data; boundary=----WebKitFormBoundaryrGKCBY7qhFd3TrwA

------WebKitFormBoundaryrGKCBY7qhFd3TrwA
Content-Disposition: form-data; name=&quot;user&quot;

yuan
------WebKitFormBoundaryrGKCBY7qhFd3TrwA
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;chrome.png&quot;
Content-Type: image/png

PNG ... content of chrome.png ...
------WebKitFormBoundaryrGKCBY7qhFd3TrwA--
</code></pre></div><p>这个例子稍微复杂点。首先生成了一个 boundary 用于分割不同的字段，为了避免与正文内容重复，boundary 很长很复杂。然后 Content-Type 里指明了数据是以 multipart/form-data 来编码，本次请求的 boundary 是什么内容。消息主体里按照字段个数又分为多个结构类似的部分，每部分都是以 --boundary 开始，紧接着是内容描述信息，然后是回车，最后是字段具体内容（文本或二进制）。如果传输的是文件，还要包含文件名和文件类型信息。消息主体最后以 --boundary-- 标示结束。关于 multipart/form-data 的详细定义，请前往 rfc1867 查看。这种方式一般用来上传文件，各大服务端语言对它也有着良好的支持。上面提到的这两种 POST 数据的方式，都是浏览器原生支持的，而且现阶段标准中原生表单也只支持这两种方式（通过 元素的 enctype 属性指定，默认为 application/x-www-form-urlencoded。其实 enctype 还支持 text/plain，不过用得非常少）。随着越来越多的 Web 站点，尤其是 WebApp，全部使用 Ajax 进行数据交互之后，我们完全可以定义新的数据提交方式，给开发带来更多便利。</p></li> <li><p>application/json
application/json 这个 Content-Type 作为响应头大家肯定不陌生。实际上，现在越来越多的人把它作为请求头，用来告诉服务端消息主体是序列化后的 JSON 字符串。由于 JSON 规范的流行，除了低版本 IE 之外的各大浏览器都原生支持 JSON.stringify，服务端语言也都有处理 JSON 的函数，使用 JSON 不会遇上什么麻烦。
JSON 格式支持比键值对复杂得多的结构化数据，这一点也很有用。记得我几年前做一个项目时，需要提交的数据层次非常深，我就是把数据 JSON 序列化之后来提交的。不过当时我是把 JSON 字符串作为 val，仍然放在键值对里，以 x-www-form-urlencoded 方式提交。
文件上传时要注意，<br>
type要改为file，<br>
enctype=multipart/form-data，如果enctype不设置，那么默认为application/x-www-form-urlencoded
上传成功的文件放在，request.FILES里面</p></li></ol> <p>基于form表单的文件上传</p> <blockquote><p>上传成功的文件放在，request.FILES里面</p></blockquote> <p>模板部分</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
用户名 &lt;input type=&quot;text&quot; name=&quot;user&quot;&gt;
头像 &lt;input type=&quot;file&quot; name=&quot;avatar&quot;&gt;
&lt;input type=&quot;submit&quot;&gt;
&lt;/form&gt;
</code></pre></div><p>视图部分</p> <div class="language- extra-class"><pre class="language-text"><code>def index(request):
    print(request.body) # 原始的请求体数据
    print(request.GET) # GET请求数据
    print(request.POST) # POST请求数据
    print(request.FILES) # 上传的文件数据
return render(request,&quot;index.html&quot;)
</code></pre></div><p>基于ajax的文件上传</p> <p><strong>ajax 发送json字符串</strong></p> <p>contentType==urlencoded ,request.POST才有数据，否则数据在request.body中所以json数据要到body中拿出原生的json字符串来解码</p> <div class="language- extra-class"><pre class="language-text"><code>    $(&quot;.btn&quot;).click(function(){

       $.ajax({
            url:&quot;&quot;,
            type:&quot;post&quot;,
            contentType:&quot;application/json&quot;,
            data:JSON.stringify({
                a:1,
                b:2
            }),
            success:function(data){#}
                console.log(data)#}
            }
        })

</code></pre></div><p>ajax上传文件</p> <p>模板</p> <div class="language-HTML extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
用户名 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
头像 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ajax-submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ajax-submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#ajax-submit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">var</span> formdata<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;avatar_img&quot;</span><span class="token punctuation">,</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#avatar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span>formdata<span class="token punctuation">,</span>
    processData<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">,</span> <span class="token comment">// 不处理数据</span>
    contentType<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不设置内容类型</span>

    <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>视图</p> <p>当contentType==urlencoded ,request.POST才有数据，否则数据在request.body中</p> <div class="language- extra-class"><pre class="language-text"><code>def index(request):
    if request.is_ajax():
    print(request.body) # 原始的请求体数据
    print(request.GET) # GET请求数据
    print(request.POST) # POST请求数据
    print(request.FILES) # 上传的文件数据
    return HttpResponse(&quot;ok&quot;)
return render(request,&quot;index.html&quot;)
</code></pre></div><p>检查浏览器的请求头：</p> <div class="language- extra-class"><pre class="language-text"><code>Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryaWl9k5ZMiTAzx3FT 
</code></pre></div><h2 id="组件"><a href="#组件" class="header-anchor">#</a> 组件</h2> <h3 id="auth模块"><a href="#auth模块" class="header-anchor">#</a> auth模块</h3> <p><code>from django.contrib import auth</code></p> <p>django.contrib.auth中提供了许多方法，这里主要介绍其中的三个：</p> <h4 id="用户验证"><a href="#用户验证" class="header-anchor">#</a> 用户验证</h4> <p>authenticate()</p> <p>提供了用户认证，即验证用户名以及密码是否正确,一般需要username password两个关键字参数如果认证信息有效，会返回一个 User 对象。</p> <p>authenticate()会在User 对象上设置一个属性标识那种认证后端认证了该用户，且该信息在后面的登录过程中是需要的。当我们试图登陆一个从数据库中直接取出来不经过authenticate()的User对象会报错的！！</p> <div class="language- extra-class"><pre class="language-text"><code>user = authenticate(username='someone',password='somepassword')
</code></pre></div><h4 id="用户登录"><a href="#用户登录" class="header-anchor">#</a> 用户登录</h4> <p><strong>login(HttpRequest, user)</strong></p> <p>该函数接受一个HttpRequest对象，以及一个认证了的User对象此函数使用django的session框架给某个已认证的用户附加上session id等信息。</p> <div class="language- extra-class"><pre class="language-text"><code>from django.contrib.auth import authenticate, login
   
def my_view(request):
  username = request.POST['username']
  password = request.POST['password']
  user = authenticate(username=username, password=password)     #验证用户提交的账号与密码
  if user is not None:
    login(request, user)              request.user == 当前登录对象
    # Redirect to a success page.
    ...
  else:
    # Return an 'invalid login' error message.
    ...
</code></pre></div><h4 id="用户注销"><a href="#用户注销" class="header-anchor">#</a> <strong>用户注销</strong></h4> <p>该函数接受一个HttpRequest对象，无返回值。当调用该函数时，当前请求的session信息会全部清除。该用户即使没有登录，使用该函数也不会报错。</p> <div class="language- extra-class"><pre class="language-text"><code>from django.contrib.auth import logout
   
def logout_view(request):
  logout(request)
  # Redirect to a success page.
</code></pre></div><h4 id="user对象"><a href="#user对象" class="header-anchor">#</a> <strong>User对象</strong></h4> <p>User 对象属性：username， password（必填项）password用哈希算法保存到数据库</p> <h5 id="user对象的-is-authenticated"><a href="#user对象的-is-authenticated" class="header-anchor">#</a> user对象的 is_authenticated()</h5> <p>如果是认证的 User 对象，返回值恒为 True 。 用于检查用户是否已经通过了认证。通过认证并不意味着用户拥有任何权限，甚至也不检查该用户是否处于激活状态，这只是表明用户成功的通过了认证。 这个方法很重要, 在后台用request.user.is_authenticated()判断用户是否已经登录，如果true则可以向前台展示request.user.name</p> <p>要求：</p> <p>1 用户登陆后才能访问某些页面，</p> <p>2 如果用户没有登录就访问该页面的话直接跳到登录页面</p> <p>3 用户在跳转的登陆界面中完成登陆后，自动访问跳转到之前访问的地址</p> <p>方法一</p> <div class="language- extra-class"><pre class="language-text"><code>def my_view(request):
  if not request.user.is_authenticated():
    return redirect('%s?next=%s' % (settings.LOGIN_URL, request.path))
</code></pre></div><p>方法二</p> <p>django已经为我们设计好了一个用于此种情况的装饰器：login_requierd()</p> <p>若用户没有登录，则会跳转到django默认的 登录URL '/accounts/login/ ' (这个值可以在settings文件中通过LOGIN_URL进行修改)。并传递 当前访问url的绝对路径 (登陆成功后，会重定向到该路径)</p> <div class="language- extra-class"><pre class="language-text"><code>from django.contrib.auth.decorators import login_required
      
@login_required
def my_view(request):
</code></pre></div><h5 id="创建用户"><a href="#创建用户" class="header-anchor">#</a> 创建用户</h5> <p>使用 create_user 辅助函数创建用户:</p> <div class="language- extra-class"><pre class="language-text"><code>from django.contrib.auth.models import User                                避免创建明文
user = User.objects.create_user（username='',password='',email=''）
user = User.objects.create_superuser（username='',password='',email=''）   超级用户
</code></pre></div><h5 id="check-password-passwd"><a href="#check-password-passwd" class="header-anchor">#</a> check_password(passwd)</h5> <p>用户需要修改密码的时候 首先要让他输入原来的密码 ，如果给定的字符串通过了密码检查，返回 True</p> <h5 id="修改密码"><a href="#修改密码" class="header-anchor">#</a> 修改密码</h5> <p>使用 set_password() 来修改密码</p> <div class="language- extra-class"><pre class="language-text"><code>user = User.objects.get(username='')
user.set_password(password='')
user.save　
</code></pre></div><h5 id="简单示例"><a href="#简单示例" class="header-anchor">#</a> 简单示例</h5> <p>注册</p> <div class="language- extra-class"><pre class="language-text"><code>def sign_up(request):
    state = None
    if request.method == 'POST':
        password = request.POST.get('password', '')
        repeat_password = request.POST.get('repeat_password', '')
        email=request.POST.get('email', '')
        username = request.POST.get('username', '')
        if User.objects.filter(username=username):
                state = 'user_exist'
        else:
                new_user = User.objects.create_user(username=username, password=password,email=email)
                new_user.save()
                return redirect('/book/')
    content = {
        'state': state,
        'user': None,
    }
    return render(request, 'sign_up.html', content)　
</code></pre></div><p>修改密码：</p> <div class="language- extra-class"><pre class="language-text"><code>@login_required
def set_password(request):
    user = request.user
    state = None
    if request.method == 'POST':
        old_password = request.POST.get('old_password', '')
        new_password = request.POST.get('new_password', '')
        repeat_password = request.POST.get('repeat_password', '')
        if user.check_password(old_password):
            if not new_password:
                state = 'empty'
            elif new_password != repeat_password:
                state = 'repeat_error'
            else:
                user.set_password(new_password)
                user.save()
                return redirect(&quot;/log_in/&quot;)
        else:
            state = 'password_error'
    content = {
        'user': user,
        'state': state,
    }
    return render(request, 'set_password.html', content) 
</code></pre></div><h3 id="form组件"><a href="#form组件" class="header-anchor">#</a> form组件</h3> <h4 id="效验字段功能"><a href="#效验字段功能" class="header-anchor">#</a> 效验字段功能</h4> <p>针对一个实例：注册用户讲解。</p> <p>模型：models.py</p> <div class="language- extra-class"><pre class="language-text"><code>class UserInfo(models.Model):
    name=models.CharField(max_length=32)
    pwd=models.CharField(max_length=32)
    email=models.EmailField()
    tel=models.CharField(max_length=32)
</code></pre></div><p>模板: register.html:</p> <div class="language-HTML extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
{% csrf_token %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>用户名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>r_pwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>确认密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>r_pwd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>r_pwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>邮箱<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>forms</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># forms组件</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets
wid_01<span class="token operator">=</span>widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
wid_02<span class="token operator">=</span>widgets<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">UserForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>
    widget<span class="token operator">=</span>wid_01
    <span class="token punctuation">)</span>
    pwd<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>wid_02<span class="token punctuation">)</span>
    r_pwd<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>wid_02<span class="token punctuation">)</span>
    email<span class="token operator">=</span>forms<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>widget<span class="token operator">=</span>wid_01<span class="token punctuation">)</span>
    tel<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>wid_01<span class="token punctuation">)</span>
</code></pre></div><p>视图函数：register</p> <div class="language- extra-class"><pre class="language-text"><code>def register(request):
if request.method==&quot;POST&quot;:
    form=UserForm(request.POST)
    if form.is_valid():
        print(form.cleaned_data) # 所有干净的字段以及对应的值
else:
    print(form.cleaned_data) #
    print(form.errors) # ErrorDict : {&quot;校验错误的字段&quot;:[&quot;错误信息&quot;,]}
    print(form.errors.get(&quot;name&quot;)) # ErrorList [&quot;错误信息&quot;,]
    return HttpResponse(&quot;OK&quot;)
form=UserForm()
return render(request,&quot;register.html&quot;,locals())
</code></pre></div><h4 id="标签渲染功能"><a href="#标签渲染功能" class="header-anchor">#</a> 标签渲染功能</h4> <ul><li>forms已经为我们做好了登录的标签啦，我们不用写，只管用就行了</li> <li>当提交因为错误失败后，刷新页面后，刚刚的值会被显示，forms会给input标签赋值刚刚输入的值</li></ul> <p>渲染方式1</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 最新版本的 Bootstrap 核心 CSS 文件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>注册页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-md-6 col-lg-offset-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
{% csrf_token %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>用户名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
{{ form.name }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
{{ form.pwd }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>确认密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
{{ form.r_pwd }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 邮箱<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
{{ form.email }}
     //渲染为 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">required</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id_email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-default pull-right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>渲染方式2</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
{% csrf_token %}

{% for field in form %}
&lt;div&gt;
&lt;label for=&quot;&quot;&gt;{{ field.label }}&lt;/label&gt;
{{ field }}
&lt;/div&gt;
{% endfor %}
&lt;input type=&quot;submit&quot; class=&quot;btn btn-default pull-right&quot;&gt;
&lt;/form&gt;
</code></pre></div><p>渲染方式3</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
{% csrf_token %}
{{ form.as_p }}
&lt;input type=&quot;submit&quot; class=&quot;btn btn-default pull-right&quot;&gt;
&lt;/form&gt;
</code></pre></div><h4 id="显示错误与重置输入信息功能"><a href="#显示错误与重置输入信息功能" class="header-anchor">#</a> <strong>显示错误与重置输入信息功能</strong></h4> <p>视图</p> <div class="language- extra-class"><pre class="language-text"><code>def register(request):

if request.method==&quot;POST&quot;:
form=UserForm(request.POST)
if form.is_valid():
print(form.cleaned_data) # 所有干净的字段以及对应的值
else:
print(form.cleaned_data) #
print(form.errors) # ErrorDict : {&quot;校验错误的字段&quot;:[&quot;错误信息&quot;,]}
print(form.errors.get(&quot;name&quot;)) # ErrorList [&quot;错误信息&quot;,]
return render(request,&quot;register.html&quot;,locals())
form=UserForm()
return render(request,&quot;register.html&quot;,locals())
</code></pre></div><p>模板</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;form action=&quot;&quot; method=&quot;post&quot; novalidate&gt;
{% csrf_token %}

{% for field in form %}
&lt;div&gt;
&lt;label for=&quot;&quot;&gt;{{ field.label }}&lt;/label&gt;
{{ field }} &lt;span class=&quot;pull-right&quot; style=&quot;color: red&quot;&gt;{{ field.errors.0 }}&lt;/span&gt;
&lt;/div&gt;
{% endfor %}
&lt;input type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;

&lt;/form&gt;
</code></pre></div><p>参数配置</p> <ul><li><p>修改标签要显示的内容 <code>label=&quot;用户名&quot;</code></p></li> <li><p>修改标签为空时提示的内容<code>error_messages={&quot;required&quot;:&quot;该字段不能为空&quot;}</code></p></li> <li><p>标签输入格式错误时要显示的内容<code>error_messages={&quot;invalid&quot;:&quot;格式错误&quot;}</code></p></li> <li><p>修改input标签的类型为密码</p> <div class="language- extra-class"><pre class="language-text"><code>from django.forms import widgets
widget=widgets.PasswordInput(attrs={&quot;class&quot;:&quot;form-control&quot;})   在标签上加上class=&quot;form-control&quot;这个属性
</code></pre></div></li></ul> <h4 id="局部钩子和全局钩子"><a href="#局部钩子和全局钩子" class="header-anchor">#</a> 局部钩子和全局钩子</h4> <p>模板</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># forms组件</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets

wid_01<span class="token operator">=</span>widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
wid_02<span class="token operator">=</span>widgets<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ValidationError
<span class="token keyword">class</span> <span class="token class-name">UserForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>
    widget<span class="token operator">=</span>wid_01
    <span class="token punctuation">)</span>
    pwd<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>wid_02<span class="token punctuation">)</span>
    r_pwd<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>wid_02<span class="token punctuation">)</span>
    email<span class="token operator">=</span>forms<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>widget<span class="token operator">=</span>wid_01<span class="token punctuation">)</span>
    tel<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>wid_01<span class="token punctuation">)</span>

    
    
    <span class="token comment"># 局部钩子</span>
    效验名字，对比数据库
    <span class="token keyword">def</span> <span class="token function">clean_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        val<span class="token operator">=</span>self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> val<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        	<span class="token keyword">return</span> val
        <span class="token keyword">else</span><span class="token punctuation">:</span>
        	<span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">&quot;用户名不能是纯数字!&quot;</span><span class="token punctuation">)</span>

    效验电话，对比数据库
    <span class="token keyword">def</span> <span class="token function">clean_tel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        val<span class="token operator">=</span>self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;tel&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">11</span><span class="token punctuation">:</span>
        	<span class="token keyword">return</span> val
        <span class="token keyword">else</span><span class="token punctuation">:</span>
        	<span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">&quot;手机号格式错误&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># 全局钩子</span>

    <span class="token keyword">def</span> <span class="token function">clean</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pwd<span class="token operator">=</span>self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">)</span>
        r_pwd<span class="token operator">=</span>self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;r_pwd&quot;</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> pwd<span class="token operator">==</span>r_pwd：  <span class="token comment"># 解决bug:当pwd错误时，不用效验确认密码选项</span>
        	<span class="token keyword">if</span> pwd<span class="token operator">==</span>r_pwd<span class="token punctuation">:</span>
        		<span class="token keyword">return</span> self<span class="token punctuation">.</span>cleaned_data
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'两次密码不一致!'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> self<span class="token punctuation">.</span>cleaned_data

    <span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method<span class="token operator">==</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        	form<span class="token operator">=</span>UserForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
            <span class="token keyword">if</span> form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">)</span> <span class="token comment"># 所有干净的字段以及对应的值</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
            clean_error<span class="token operator">=</span>form<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;__all__&quot;</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">&quot;register.html&quot;</span><span class="token punctuation">,</span><span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            form<span class="token operator">=</span>UserForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">&quot;register.html&quot;</span><span class="token punctuation">,</span><span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>视图</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">novalidate</span><span class="token punctuation">&gt;</span></span>
{% csrf_token %}

{% for field in form %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ field.label }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    {{ field }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pull-right<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span> red</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        
    {% if field.label == 'R pwd' %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ clean_error.0 }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    {% endif %}
    {{ field.errors.0 }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
{% endfor %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-default<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="分页器"><a href="#分页器" class="header-anchor">#</a> 分页器</h3> <p>难点</p> <ul><li>不能在index页面显示太多的分页标签</li> <li>分页标签第一个和最后一个，</li> <li>中间的分页标签要顾及两边的分页标签</li></ul> <p>分液器的使用</p> <div class="language-python extra-class"><pre class="language-python"><code>book_list<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
paginator <span class="token operator">=</span> Paginator<span class="token punctuation">(</span>book_list<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>        <span class="token comment">#拿到一个分页器对象</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;count:&quot;</span><span class="token punctuation">,</span>paginator<span class="token punctuation">.</span>count<span class="token punctuation">)</span>             <span class="token comment">#数据总数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;num_pages&quot;</span><span class="token punctuation">,</span>paginator<span class="token punctuation">.</span>num_pages<span class="token punctuation">)</span>      <span class="token comment">#总页数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;page_range&quot;</span><span class="token punctuation">,</span>paginator<span class="token punctuation">.</span>page_range<span class="token punctuation">)</span>    <span class="token comment">#页码的列表</span>
page1<span class="token operator">=</span>paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                     <span class="token comment">#第1页的page对象</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> page1<span class="token punctuation">:</span>                             <span class="token comment">#遍历第1页的所有数据对象</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>page1<span class="token punctuation">.</span>object_list<span class="token punctuation">)</span>                    <span class="token comment">#第1页的所有数据</span>
page2<span class="token operator">=</span>paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>page2<span class="token punctuation">.</span>has_next<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token comment">#是否有下一页</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>page2<span class="token punctuation">.</span>next_page_number<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment">#下一页的页码</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>page2<span class="token punctuation">.</span>has_previous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token comment">#是否有上一页</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>page2<span class="token punctuation">.</span>previous_page_number<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#上一页的页码</span>
current_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">)</span>   <span class="token comment">#获取当前的页数</span>
 <span class="token comment"># 抛错</span>
超出页面
<span class="token comment">#page=paginator.page(12) # error:EmptyPage</span>
<span class="token comment">#page=paginator.page(&quot;z&quot;) # error:PageNotAnInteger                   </span>
</code></pre></div><p>view</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse
<span class="token comment"># Create your views here.</span>
<span class="token keyword">from</span> app01<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>paginator <span class="token keyword">import</span> Paginator<span class="token punctuation">,</span> EmptyPage<span class="token punctuation">,</span> PageNotAnInteger
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    批量导入数据:
    Booklist=[]
    for i in range(100):
    Booklist.append(Book(title=&quot;book&quot;+str(i),price=30+i*i))
    Book.objects.bulk_create(Booklist)
    '''</span>
 	book_list<span class="token operator">=</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    paginator<span class="token operator">=</span>Paginator<span class="token punctuation">(</span>book_list<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;count:&quot;</span><span class="token punctuation">,</span>paginator<span class="token punctuation">.</span>count<span class="token punctuation">)</span>           <span class="token comment">#数据总数</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;num_pages&quot;</span><span class="token punctuation">,</span>paginator<span class="token punctuation">.</span>num_pages<span class="token punctuation">)</span>    <span class="token comment">#总页数</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;page_range&quot;</span><span class="token punctuation">,</span>paginator<span class="token punctuation">.</span>page_range<span class="token punctuation">)</span>  <span class="token comment">#页码的列表</span>

    current_page_num<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> paginator<span class="token punctuation">.</span>num_pages<span class="token operator">&gt;</span><span class="token number">11</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> current_page_num<span class="token operator">-</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">:</span>
            page_range<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> current_page_num<span class="token operator">+</span><span class="token number">5</span><span class="token operator">&gt;</span>paginator<span class="token punctuation">.</span>num_pages<span class="token punctuation">:</span>
            page_range<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span>paginator<span class="token punctuation">.</span>num_pages<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>paginator<span class="token punctuation">.</span>num_pages<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            page_range<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span>current_page_num<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span>current_page_num<span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        page_range<span class="token operator">=</span>paginator<span class="token punctuation">.</span>page_range
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        current_page<span class="token operator">=</span>paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span>current_page_num<span class="token punctuation">)</span>

        <span class="token comment"># 显示某一页具体数据的两种方式:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;object_list&quot;</span><span class="token punctuation">,</span>current_page<span class="token punctuation">.</span>object_list<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> current_page<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

    <span class="token keyword">except</span> EmptyPage <span class="token keyword">as</span> e<span class="token punctuation">:</span>
         current_page<span class="token operator">=</span>paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span><span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>扩展</p> <div class="language-HTML extra-class"><pre class="language-html"><code>def index(request):

book_list=Book.objects.all()
paginator = Paginator(book_list, 15)
page = request.GET.get('page',1)
currentPage=int(page)

# 如果页数十分多时，换另外一种显示方式
if paginator.num_pages&gt;11:
if currentPage-5&lt;1:
pageRange=range(1,11)
elif currentPage+5&gt;paginator.num_pages:
pageRange=range(currentPage-5,paginator.num_pages+1)
else:
pageRange=range(currentPage-5,currentPage+5)
else:
pageRange=paginator.page_range
try:
print(page)
book_list = paginator.page(page)
except PageNotAnInteger:
book_list = paginator.page(1)
except EmptyPage:
book_list = paginator.page(paginator.num_pages)

return render(request,&quot;index.html&quot;,locals())
</code></pre></div><h3 id="cookie与session"><a href="#cookie与session" class="header-anchor">#</a> cookie与session</h3> <h4 id="会话跟踪技术"><a href="#会话跟踪技术" class="header-anchor">#</a> 会话跟踪技术</h4> <p>1 什么是会话跟踪技术我们需要先了解一下什么是会话！可以把会话理解为客户端与服务器之间的一次会晤，在一次会晤中可能会包含多次请求和响应。例如你给10086打个电话，你就是客户端，而10086服务人员就是服务器了。从双方接通电话那一刻起，会话就开始了，到某一方挂断电话表示会话结束。在通话过程中，你会向10086发出多个请求，那么这多个请求都在一个会话中。在JavaWeb中，客户向某一服务器发出第一个请求开始，会话就开始了，直到客户关闭了浏览器会话结束。 在一个会话的多个请求中共享数据，这就是会话跟踪技术。例如在一个会话中的请求如下：  请求银行主页；</p> <ul><li>请求登录（请求参数是用户名和密码）；</li> <li>请求转账（请求参数与转账相关的数据）；</li> <li>请求信誉卡还款（请求参数与还款相关的数据）。
在这上会话中当前用户信息必须在这个会话中共享的，因为登录的是张三，那么在转账和还款时一定是相对张三的转账和还款！这就说明我们必须在一个会话过程中有共享数据的能力。</li></ul> <p>2 会话路径技术使用Cookie或session完成
我们知道HTTP协议是无状态协议，也就是说每个请求都是独立的！无法记录前一次请求的状态。但HTTP协议中可以使用Cookie来完成会话跟踪！在Web开发中，使用session来完成会话跟踪，session底层依赖Cookie技术。</p> <h4 id="cookie概述"><a href="#cookie概述" class="header-anchor">#</a> Cookie概述</h4> <p>Cookie翻译成中文是小甜点，小饼干的意思。在HTTP中它表示服务器送给客户端浏览器的小甜点。其实Cookie是key-value结构，类似于一个python中的字典。随着服务器端的响应发送给客户端浏览器。然后客户端浏览器会把Cookie保存起来，当下一次再访问服务器时把Cookie再发送给服务器。 Cookie是由服务器创建，然后通过响应发送给客户端的一个键值对。客户端会保存Cookie，并会标注出Cookie的来源（哪个服务器的Cookie）。当客户端向服务器发出请求时会把所有这个服务器Cookie包含在请求中发送给服务器，这样服务器就可以识别客户端了！</p> <p><img src="https://leiyiming.oss-cn-shenzhen.aliyuncs.com/img/image-20200626191615113.png" alt="image-20200626191615113"></p> <p>Cookie规范</p> <p>Cookie大小上限为4KB；</p> <p>一个服务器最多在客户端浏览器上保存20个Cookie；</p> <p>一个浏览器最多保存300个Cookie；</p> <p>上面的数据只是HTTP的Cookie规范，但在浏览器大战的今天，一些浏览器为了打败对手，为了展现自己的能力起见，可能对Cookie规范“扩展”了一些，例如每个Cookie的大小为8KB，最多可保存500个Cookie等！但也不会出现把你硬盘占满的可能！</p> <p>注意，不同浏览器之间是不共享Cookie的。也就是说在你使用IE访问服务器时，服务器会把Cookie发给IE，然后由IE保存起来，当你在使用FireFox访问服务器时，不可能把IE保存的Cookie发送给服务器。</p> <p>Cookie与HTTP头</p> <p>Cookie是通过HTTP请求和响应头在客户端和服务器端传递的：</p> <p>Cookie：请求头，客户端发送给服务器端；</p> <p>格式：Cookie: a=A; b=B; c=C。即多个Cookie用分号离开； Set-Cookie：响应头，服务器端发送给客户端；</p> <p>一个Cookie对象一个Set-Cookie： Set-Cookie: a=A Set-Cookie: b=B Set-Cookie: c=C</p> <p>Cookie的覆盖</p> <p>如果服务器端发送重复的Cookie那么会覆盖原有的Cookie，例如客户端的第一个请求服务器端发送的Cookie是：Set-Cookie: a=A；第二请求服务器端发送的是：Set-Cookie: a=AA，那么客户端只留下一个Cookie，即：a=AA。</p> <p>django中的cookie语法</p> <p>设置cookie：</p> <p>响应体可以设置cookie，rep = HttpResponse(...) 或 rep ＝ render(request, ...) 或 rep ＝ redirect()</p> <div class="language- extra-class"><pre class="language-text"><code>rep = HttpResponse(...) 或 rep ＝ render(request, ...) 或 rep ＝ redirect()
rep.set_cookie(key,value,...)
rep.set_signed_cookie(key,value,salt='加密盐',...)
</code></pre></div><p>源码：</p> <div class="language- extra-class"><pre class="language-text"><code>class HttpResponseBase:
def set_cookie(self, key, 键 value='', 值)
　　　　　　　　　　　　
　　　　　　　　　　　　 max_age=None, 超长时间
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　cookie需要延续的时间（以秒为单位）
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　如果参数是\ None`` ，这个cookie会延续到浏览器关闭为止。
　　　　　　　　　　　　 expires=None, 超长时间
　　　　　　　　　　　　　　　　　　　　　　　　　　expires默认None ,cookie失效的实际日期/时间， ie浏览器不支持。
　　　　　　　　　　　　　　　　　　　　　　　　　　　　
　　　　　　　　　　　　 path='/', Cookie生效的路径， path='index',表示只有index下的路径才可以拿到cookice
浏览器只会把cookie回传给带有该路径的页面，这样可以避免将
cookie传给站点中的其他的应用。
/ 表示根路径，特殊的：根路径的cookie可以被任何url的页面访问
　　　　　　　　　　　　
domain=None, Cookie生效的域名


你可用这个参数来构造一个跨站cookie。
如， domain=&quot;.example.com&quot;
所构造的cookie对下面这些站点都是可读的：
www.example.com 、 www2.example.com
　　　　　　　　　　　　　　　　　　　　　　　　　和an.other.sub.domain.example.com 。
如果该参数设置为 None ，cookie只能由设置它的站点读取。
　　　　　　　　　　　　 secure=False, 如果设置为 True ，浏览器将通过HTTPS来回传cookie。
　　　　　　　　　　　　 httponly=False 只能http协议传输，无法被JavaScript获取
（不是绝对，底层抓包可以获取到也可以被覆盖）
　　　　　　　　　　): pass
</code></pre></div><p>max_age=None,  超长时间  cookie需要延续的时间（以秒为单位）,　如果参数是\ None`` ，这个cookie会延续到浏览器关闭为止。
expires=None, 超长时间  　expires默认None ,cookie失效的实际日期/时间， ie浏览器不支持。
path='/', Cookie生效的路径， path='index',表示只有index下的路径才可以拿到cookice　　浏览器只会把cookie回传给带有该路径的页面，这样可以避免将
cookie传给站点中的其他的应用。
/ 表示根路径，特殊的：根路径的cookie可以被任何url的页面访问</p> <p>获取cookie：</p> <p><code>request.COOKIES</code></p> <p>删除cookie： <code>response.delete_cookie(&quot;cookie_key&quot;,path=&quot;/&quot;,domain=name)</code></p> <p>session</p> <p>Session是服务器端技术，利用这个技术，服务器在运行时可以 为每一个用户的浏览器创建一个其独享的session对象，由于 session为用户浏览器独享，所以用户在访问服务器的web资源时 ，可以把各自的数据放在各自的session中，当用户再去访问该服务器中的其它web资源时，其它web资源再从用户各自的session中 取出数据为用户服务</p> <p><img src="https://leiyiming.oss-cn-shenzhen.aliyuncs.com/img/image-20200626192034543.png" alt="image-20200626192034543"></p> <p>django中session语法
session只给一个session——key这个钥匙，数据都存在“保险箱”（django_session表）中，
Django-session内部操作
设置session</p> <div class="language- extra-class"><pre class="language-text"><code>1 生成随机字符串   ltv8zy1kh5lxj1if1fcs2pqwodumr45t
2 response.set_cookie(&quot;sessionid&quot;,ltv8zy1kh5lxj1if1fcs2pqwodumr45t)
3 在django—session表中创建一条记录:
   session-key                                     session-data
   ltv8zy1kh5lxj1if1fcs2pqwodumr45t       {&quot;is_login&quot;:True,&quot;username&quot;:&quot;yuan&quot;}
</code></pre></div><p>读session</p> <div class="language- extra-class"><pre class="language-text"><code>1  request.COOKIE.get(&quot;session&quot;)  #  ltv8zy1kh5lxj1if1fcs2pqwodumr45t
2  django-session表中过滤纪录:
在django—session表中创建一条记录:
session-key                                   session-data
ltv8zy1kh5lxj1if1fcs2pqwodumr45t       {&quot;is_login&quot;:True,&quot;username&quot;:&quot;yuan&quot;}
obj=django—session.objects .filter(session-key=ltv8zy1kh5lxj1if1fcs2pqwodumr45t).first()


3 obj.session-data.get(&quot;is_login&quot;)
</code></pre></div><p>一个浏览器与一个服务器应该维持一个session_key,当切换用户时，应该做的是更新session_key的值相当一，一个session_key对应一个浏览器，一个session_data对应一个用户，所以检查cookie，有值就进行更新，没有值，说明就是新浏览器，需要创建</p> <div class="language- extra-class"><pre class="language-text"><code>if request.COOKIE.get(&quot;session&quot;)
    进行更新操作
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>1、设置Sessions值
request.session['session_name'] =&quot;admin&quot;
2、获取Sessions值
session_name = request.session[&quot;session_name&quot;]
3、删除Sessions值
del request.session[&quot;session_name&quot;]


4、flush()    注销时用
    删除当前的会话数据并删除会话的Cookie。这用于确保前面的会话数据不可以再次被用户的浏览器访问


5、get(key, default=None)
fav_color = request.session.get('fav_color', 'red')
6、pop(key)
fav_color = request.session.pop('fav_color')
7、keys()
8、items()
9、setdefault()
10 用户session的随机字符串
request.session.session_key


# 将所有Session失效日期小于当前日期的数据删除
request.session.clear_expired()


# 检查 用户session的随机字符串 在数据库中是否
request.session.exists(&quot;session_key&quot;)


# 删除当前用户的所有Session数据
request.session.delete(&quot;session_key&quot;)


request.session.set_expiry(value)
* 如果value是个整数，session会在些秒数后失效。
* 如果value是个datatime或timedelta，session就会在这个时间后失效。
* 如果value是0,用户关闭浏览器session就会失效。
* 如果value是None,session会依赖全局session失效策略。
</code></pre></div><p>session配置</p> <div class="language- extra-class"><pre class="language-text"><code>Django默认支持Session，并且默认是将Session数据存储在数据库中，即：django_session 表中。


a. 配置 settings.py


SESSION_ENGINE = 'django.contrib.sessions.backends.db' # 引擎（默认）


SESSION_COOKIE_NAME ＝ &quot;sessionid&quot; # Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串（默认）
SESSION_COOKIE_PATH ＝ &quot;/&quot; # Session的cookie保存的路径（默认）
SESSION_COOKIE_DOMAIN = None # Session的cookie保存的域名（默认）
SESSION_COOKIE_SECURE = False # 是否Https传输cookie（默认）
SESSION_COOKIE_HTTPONLY = True # 是否Session的cookie只支持http传输（默认）
SESSION_COOKIE_AGE = 1209600 # Session的cookie失效日期（2周）（默认）
SESSION_EXPIRE_AT_BROWSER_CLOSE = False # 是否关闭浏览器使得Session过期（默认）
SESSION_SAVE_EVERY_REQUEST = False #是否每次请求都保存Session，默认修改之后才保存（默认），如果设置为true，而且每天都访问，就一直能用，必须要连续2周不登录才可以
</code></pre></div><h3 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h3> <p><strong>中间件的概念</strong>中间件顾名思义，是介于request与response处理之间的一道处理过程，相对比较轻量级，并且在全局上改变django的输入与输出。因为改变的是全局，所以需要谨慎实用，用不好会影响到性能。</p> <p><img src="https://leiyiming.oss-cn-shenzhen.aliyuncs.com/img/image-20200626204535902.png" alt="image-20200626204535902"></p> <p>如果你想修改请求，例如被传送到view中的<strong>HttpRequest</strong>对象。 或者你想修改view返回的<strong>HttpResponse</strong>对象，这些都可以通过中间件来实现。</p> <p>可能你还想在view执行之前做一些操作，这种情况就可以用 middleware来实现。</p> <p>Django默认的Middleware：</p> <div class="language- extra-class"><pre class="language-text"><code>MIDDLEWARE = [
'django.middleware.security.SecurityMiddleware',
'django.contrib.sessions.middleware.Ses8sionMiddleware',
'django.middleware.common.CommonMiddleware',
'django.middleware.csrf.CsrfViewMiddleware',
'django.contrib.auth.middleware.AuthenticationMiddleware',
'django.contrib.messages.middleware.MessageMiddleware',
'django.middleware.clickjacking.XFrameOptionsMiddleware',
]
</code></pre></div><p><strong>自定义中间件</strong></p> <p>中间件中一共有四个方法：</p> <ol><li>process_request  没有返回值</li> <li>process_view</li> <li>process_exception  发生错误，有exception发出响应，跳过process_response</li> <li>process_response   必须有返回值</li></ol> <p>process_request，process_response</p> <p>当用户发起请求的时候会依次经过所有的的中间件，的process_request函数,最后到达views的函数中，views函数处理后，在依次穿过中间件，的process_response,最后返回给请求者。</p> <p><img src="https://leiyiming.oss-cn-shenzhen.aliyuncs.com/img/image-20200626204950158.png" alt="image-20200626204950158"></p> <p>自定义</p> <p>导入MiddlewareMixin</p> <div class="language- extra-class"><pre class="language-text"><code>from django.utils.deprecation import MiddlewareMixin
</code></pre></div><p>在setting中注册中间件</p> <p><strong>in views:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>def index(request):
    print(&quot;view函数...&quot;)
    return HttpResponse(&quot;OK&quot;)
</code></pre></div><p>in Mymiddlewares.py：</p> <div class="language- extra-class"><pre class="language-text"><code>class Md1(MiddlewareMixin):
    def process_request(self,request):
        print(&quot;Md1请求&quot;)
    def process_response(self,request,response):
        print(&quot;Md1返回&quot;)
        return response
class Md2(MiddlewareMixin):    
    def process_request(self,request):
        print(&quot;Md2请求&quot;)
        #return HttpResponse(&quot;Md2中断&quot;)
    def process_response(self,request,response):
        print(&quot;Md2返回&quot;)
        return response
</code></pre></div><p>结果</p> <div class="language- extra-class"><pre class="language-text"><code>Md1请求
Md2请求
view函数...
Md2返回
Md1返回
</code></pre></div><p>**注意：**如果当请求到达请求2的时候直接不符合条件返回，即return HttpResponse(&quot;Md2中断&quot;)，程序将把请求直接发给中间件2返回，然后依次返回到请求者，结果如下：</p> <p>返回Md2中断的页面，后台打印如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Md1请求
Md2请求
Md2返回
Md1返回
</code></pre></div><p><strong>流程图如下：</strong></p> <p><img src="https://leiyiming.oss-cn-shenzhen.aliyuncs.com/img/877318-20180523153139864-2049371026.png" alt="877318-20180523153139864-2049371026"></p> <p>process_view</p> <div class="language- extra-class"><pre class="language-text"><code>process_view(self, request, callback, callback_args, callback_kwargs)
</code></pre></div><p><strong>Mymiddlewares.py</strong>修改如下</p> <div class="language- extra-class"><pre class="language-text"><code>from django.utils.deprecation import MiddlewareMixin
from django.shortcuts import HttpResponse


class Md1(MiddlewareMixin):
    def process_request(self,request):
        print(&quot;Md1请求&quot;)
        #return HttpResponse(&quot;Md1中断&quot;)
    def process_response(self,request,response):
        print(&quot;Md1返回&quot;)
        return response         必须返回response

    def process_view(self, request, callback, callback_args, callback_kwargs):
        print(&quot;Md1view&quot;)

class Md2(MiddlewareMixin):
    def process_request(self,request):
        print(&quot;Md2请求&quot;)
        return HttpResponse(&quot;Md2中断&quot;)
    def process_response(self,request,response):
        print(&quot;Md2返回&quot;)
        return response

    def process_view(self, request, callback, callback_args, callback_kwargs):
        print(&quot;Md2view&quot;)
</code></pre></div><p>结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Md1请求
Md2请求
Md1view
Md2view
view函数...
Md2返回
Md1返回
</code></pre></div><p>下图进行分析上面的过程：</p> <p><img src="https://leiyiming.oss-cn-shenzhen.aliyuncs.com/img/877318-20180523150722556-373788290.png" alt="877318-20180523150722556-373788290"></p> <p>当最后一个中间的process_request到达路由关系映射之后，返回到中间件1的process_view，然后依次往下，到达views函数，最后通过process_response依次返回到达用户。</p> <p>process_view可以用来调用视图函数：</p> <div class="language- extra-class"><pre class="language-text"><code>class Md1(MiddlewareMixin):
    def process_request(self,request):
        print(&quot;Md1请求&quot;)
        #return HttpResponse(&quot;Md1中断&quot;)
    def process_response(self,request,response):
        print(&quot;Md1返回&quot;)
        return response
    def process_view(self, request, callback, callback_args, callback_kwargs):
        # return HttpResponse(&quot;hello&quot;)
        response=callback(request,*callback_args,**callback_kwargs)
        return response
</code></pre></div><p>结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Md1请求
Md2请求
view函数...
Md2返回
Md1返回
</code></pre></div><p>注意：process_view如果有返回值，会越过其他的process_view以及视图函数，但是所有的process_response都还会执行。</p> <p>process_exception</p> <div class="language- extra-class"><pre class="language-text"><code>process_exception(self, request, exception)
</code></pre></div><p>示例修改如下：</p> <div class="language- extra-class"><pre class="language-text"><code>class Md1(MiddlewareMixin):

    def process_request(self,request):
        print(&quot;Md1请求&quot;)
        #return HttpResponse(&quot;Md1中断&quot;)
    def process_response(self,request,response):
        print(&quot;Md1返回&quot;)
        return response

    def process_view(self, request, callback, callback_args, callback_kwargs):


        # return HttpResponse(&quot;hello&quot;)


        # response=callback(request,*callback_args,**callback_kwargs)
        # return response
        print(&quot;md1 process_view...&quot;)


    def process_exception(self):
        print(&quot;md1 process_exception...&quot;)


class Md2(MiddlewareMixin):


    def process_request(self,request):
        print(&quot;Md2请求&quot;)
        # return HttpResponse(&quot;Md2中断&quot;)
    def process_response(self,request,response):
        print(&quot;Md2返回&quot;)
        return response
    def process_view(self, request, callback, callback_args, callback_kwargs):
        print(&quot;md2 process_view...&quot;)

    def process_exception(self):
        print(&quot;md1 process_exception...&quot;)
</code></pre></div><p>结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Md1请求
Md2请求
md1 process_view...
md2 process_view...
view函数...

Md2返回
Md1返回
</code></pre></div><p>流程图如下：</p> <p>当views出现错误时：</p> <p><img src="https://leiyiming.oss-cn-shenzhen.aliyuncs.com/img/877318-20180523152523125-1475347796.png" alt="877318-20180523152523125-1475347796"></p> <p>将md2的process_exception修改如下：</p> <div class="language- extra-class"><pre class="language-text"><code>def process_exception(self,request,exception):
    print(&quot;md2 process_exception...&quot;)
    return HttpResponse(&quot;error&quot;)
</code></pre></div><p>结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Md1请求
Md2请求
md1 process_view...
md2 process_view...
view函数...
md2 process_exception...
Md2返回
Md1返回
</code></pre></div><p><strong>应用案例</strong></p> <p><strong>1、做IP访问频率限制</strong>，某些IP访问服务器的频率过高，进行拦截，比如限制每分钟不能超过20次。</p> <p><strong>2、URL访问过滤</strong></p> <p>如果用户访问的是login视图（放过）如果访问其他视图，需要检测是不是有session认证，已经有了放行，没有返回login，这样就省得在多个视图函数上写装饰器了！</p> <div class="language- extra-class"><pre class="language-text"><code>class AuthMiddleware(MiddlewareMixin):

    def process_request(self,request):
        white_list = settings.WHITE_LIST
        if request.path in white_list:
            return None
        if not request.user.is_authenticated():
            return redirect(&quot;/login/&quot;)
            
</code></pre></div><p><strong>源码试读</strong>作为延伸扩展内容，有余力的同学可以尝试着读一下以下两个自带的中间件：</p> <div class="language- extra-class"><pre class="language-text"><code>'django.contrib.sessions.middleware.SessionMiddleware',
'django.contrib.auth.middleware.AuthenticationMiddleware',
</code></pre></div></div></div> <div class="page-edit"><div class="edit-link"><a href="https://wjxm.coding.net/p/blog/d/blog/git/tree/master/docs/05.后端/10.django/02.django知识点整理.md?tab=file" target="_blank" rel="noopener noreferrer">在线编辑</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <a href="typora://05.后端\10.django\02.django知识点整理.md" target="_self" rel="noopener noreferrer">本地编辑</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020/08/18, 10:08:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/cb26a5/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">
        django基础
      </div></a> <a href="/pages/700736/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">
        rbac权限组件的开发
      </div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/cb26a5/" class="prev">django基础</a></span> <span class="next"><a href="/pages/700736/">rbac权限组件的开发</a>
        →
      </span></p></div></div></div> <!----> </main></div> <div class="footer"><div class="icons"><a href="mailto:1473241371@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/wjxm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
     | Copyright © 2019-2020
    <span>leiyiming  <br><a href="http://www.beian.miit.gov.cn">渝ICP备20006026号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.5a5da2fb.js" defer></script><script src="/assets/js/3.821dca7b.js" defer></script><script src="/assets/js/51.b2442e53.js" defer></script>
  </body>
</html>